<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>SE-0244 Opaque Result Types - Swift Evolution List</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>SE-0244 Opaque Result Types | Swift Evolution List</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="SE-0244 Opaque Result Types" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Yuhuu!" /> <meta property="og:description" content="Yuhuu!" /> <link rel="canonical" href="http://localhost:4000/docs/2019-08-26-0244-opaque-result-types.html" /> <meta property="og:url" content="http://localhost:4000/docs/2019-08-26-0244-opaque-result-types.html" /> <meta property="og:site_name" content="Swift Evolution List" /> <script type="application/ld+json"> {"url":"http://localhost:4000/docs/2019-08-26-0244-opaque-result-types.html","headline":"SE-0244 Opaque Result Types","description":"Yuhuu!","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000" class="site-title lh-tight">Swift Evolution List</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="http://localhost:4000/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="http://localhost:4000/" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="http://localhost:4000/about/" class="navigation-list-link">About</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0001-keywords-as-argument-labels.html" class="navigation-list-link">SE-0001 Allow (most) keywords as argument labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0002-remove-currying.html" class="navigation-list-link">SE-0002 Removing currying `func` declaration syntax</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0003-remove-var-parameters.html" class="navigation-list-link">SE-0003 Removing `var` from Function Parameters</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0004-remove-pre-post-inc-decrement.html" class="navigation-list-link">SE-0004 Remove the `++` and `--` operators</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0005-objective-c-name-translation.html" class="navigation-list-link">SE-0005 Better Translation of Objective-C APIs Into Swift</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0006-apply-api-guidelines-to-the-standard-library.html" class="navigation-list-link">SE-0006 Apply API Guidelines to the Standard Library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0007-remove-c-style-for-loops.html" class="navigation-list-link">SE-0007 Remove C-style for-loops with conditions and incrementers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0008-lazy-flatmap-for-optionals.html" class="navigation-list-link">SE-0008 Add a Lazy flatMap for Sequences of Optionals #</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0009-require-self-for-accessing-instance-members.html" class="navigation-list-link">SE-0009 Require self for accessing instance members</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0010-add-staticstring-unicodescalarview.html" class="navigation-list-link">SE-0010 Add StaticString.UnicodeScalarView</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0011-replace-typealias-associated.html" class="navigation-list-link">SE-0011 Replace `typealias` keyword with `associatedtype` for associated type declarations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0012-add-noescape-to-public-library-api.html" class="navigation-list-link">SE-0012 Add `@noescape` to public library API</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0013-remove-partial-application-super.html" class="navigation-list-link">SE-0013 Remove Partial Application of Non-Final Super Methods (Swift 2.2)</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0014-constrained-AnySequence.html" class="navigation-list-link">SE-0014 Constraining `AnySequence.init`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0015-tuple-comparison-operators.html" class="navigation-list-link">SE-0015 Tuple comparison operators</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0016-initializers-for-converting-unsafe-pointers-to-ints.html" class="navigation-list-link">SE-0016 Add initializers to Int and UInt to convert from UnsafePointer and UnsafeMutablePointer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0017-convert-unmanaged-to-use-unsafepointer.html" class="navigation-list-link">SE-0017 Change `Unmanaged` to use `UnsafePointer`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0018-flexible-memberwise-initialization.html" class="navigation-list-link">SE-0018 Flexible Memberwise Initialization</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0019-package-manager-testing.html" class="navigation-list-link">SE-0019 Swift Testing</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0020-if-swift-version.html" class="navigation-list-link">SE-0020 Swift Language Version Build Configuration</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0021-generalized-naming.html" class="navigation-list-link">SE-0021 Naming Functions with Argument Labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0022-objc-selectors.html" class="navigation-list-link">SE-0022 Referencing the Objective-C selector of a method</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0023-api-guidelines.html" class="navigation-list-link">SE-0023 API Design Guidelines</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0024-optional-value-setter.html" class="navigation-list-link">SE-0024 Optional Value Setter `??=`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0025-scoped-access-level.html" class="navigation-list-link">SE-0025 Scoped Access Level</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0026-abstract-classes-and-methods.html" class="navigation-list-link">SE-0026 Abstract classes and methods</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0027-string-from-code-units.html" class="navigation-list-link">SE-0027 Expose code unit initializers on String</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0028-modernizing-debug-identifiers.html" class="navigation-list-link">SE-0028 Modernizing Swift's Debugging Identifiers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0029-remove-implicit-tuple-splat.html" class="navigation-list-link">SE-0029 Remove implicit tuple splat behavior from function applications</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0030-property-behavior-decls.html" class="navigation-list-link">SE-0030 Property Behaviors</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0031-adjusting-inout-declarations.html" class="navigation-list-link">SE-0031 Adjusting `inout` Declarations for Type Decoration</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0032-sequencetype-find.html" class="navigation-list-link">SE-0032 Add `first(where:)` method to `Sequence`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0033-import-objc-constants.html" class="navigation-list-link">SE-0033 Import Objective-C Constants as Swift Types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0034-disambiguating-line.html" class="navigation-list-link">SE-0034 Disambiguating Line Control Statements from Debugging Identifiers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0035-limit-inout-capture.html" class="navigation-list-link">SE-0035 Limiting `inout` capture to `@noescape` contexts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0036-enum-dot.html" class="navigation-list-link">SE-0036 Requiring Leading Dot Prefixes for Enum Instance Member Implementations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0037-clarify-comments-and-operators.html" class="navigation-list-link">SE-0037 Clarify interaction between comments & operators</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0038-swiftpm-c-language-targets.html" class="navigation-list-link">SE-0038 Package Manager C Language Target Support</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0039-playgroundliterals.html" class="navigation-list-link">SE-0039 Modernizing Playground Literals</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0040-attributecolons.html" class="navigation-list-link">SE-0040 Replacing Equal Signs with Colons For Attribute Arguments</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0041-conversion-protocol-conventions.html" class="navigation-list-link">SE-0041 Updating Protocol Naming Conventions for Conversions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0042-flatten-method-types.html" class="navigation-list-link">SE-0042 Flattening the function type of unapplied method references</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0043-declare-variables-in-case-labels-with-multiple-patterns.html" class="navigation-list-link">SE-0043 Declare variables in 'case' labels with multiple patterns </a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0044-import-as-member.html" class="navigation-list-link">SE-0044 Import as member</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0045-scan-takewhile-dropwhile.html" class="navigation-list-link">SE-0045 Add prefix(while:) and drop(while:) to the stdlib</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0046-first-label.html" class="navigation-list-link">SE-0046 Establish consistent label behavior across all parameters including first labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0047-nonvoid-warn.html" class="navigation-list-link">SE-0047 Defaulting non-Void functions so they warn on unused results</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0048-generic-typealias.html" class="navigation-list-link">SE-0048 Generic Type Aliases</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0049-noescape-autoclosure-type-attrs.html" class="navigation-list-link">SE-0049 Move @noescape and @autoclosure to be type attributes</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0050-floating-point-stride.html" class="navigation-list-link">SE-0050 Decoupling Floating Point Strides from Generic Implementations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0051-stride-semantics.html" class="navigation-list-link">SE-0051 Conventionalizing `stride` semantics</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0052-iterator-post-nil-guarantee.html" class="navigation-list-link">SE-0052 Change IteratorType post-nil guarantee</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0053-remove-let-from-function-parameters.html" class="navigation-list-link">SE-0053 Remove explicit use of `let` from Function Parameters</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0054-abolish-iuo.html" class="navigation-list-link">SE-0054 Abolish `ImplicitlyUnwrappedOptional` type</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0055-optional-unsafe-pointers.html" class="navigation-list-link">SE-0055 Make unsafe pointer nullability explicit using Optional</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0056-trailing-closures-in-guard.html" class="navigation-list-link">SE-0056 Allow trailing closures in `guard` conditions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0057-importing-objc-generics.html" class="navigation-list-link">SE-0057 Importing Objective-C Lightweight Generics</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0058-objectivecbridgeable.html" class="navigation-list-link">SE-0058 Allow Swift types to provide custom Objective-C representations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0059-updated-set-apis.html" class="navigation-list-link">SE-0059 Update API Naming Guidelines and Rewrite Set APIs Accordingly</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0060-defaulted-parameter-order.html" class="navigation-list-link">SE-0060 Enforcing order of defaulted parameters</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0061-autoreleasepool-signature.html" class="navigation-list-link">SE-0061 Add Generic Result and Error Handling to autoreleasepool()</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0062-objc-keypaths.html" class="navigation-list-link">SE-0062 Referencing Objective-C key-paths</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0063-swiftpm-system-module-search-paths.html" class="navigation-list-link">SE-0063 SwiftPM System Module Search Paths</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0064-property-selectors.html" class="navigation-list-link">SE-0064 Referencing the Objective-C selector of property getters and setters</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0065-collections-move-indices.html" class="navigation-list-link">SE-0065 A New Model for Collections and Indices</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0066-standardize-function-type-syntax.html" class="navigation-list-link">SE-0066 Standardize function type argument syntax to require parentheses</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0067-floating-point-protocols.html" class="navigation-list-link">SE-0067 Enhanced Floating Point Protocols</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0068-universal-self.html" class="navigation-list-link">SE-0068 Expanding Swift `Self` to class members and value types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0069-swift-mutability-for-foundation.html" class="navigation-list-link">SE-0069 Mutability and Foundation Value Types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0070-optional-requirements.html" class="navigation-list-link">SE-0070 Make Optional Requirements Objective-C-only</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0071-member-keywords.html" class="navigation-list-link">SE-0071 Allow (most) keywords in member references</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0072-eliminate-implicit-bridging-conversions.html" class="navigation-list-link">SE-0072 Fully eliminate implicit bridging conversions from Swift</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0073-noescape-once.html" class="navigation-list-link">SE-0073 Marking closures as executing exactly once</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0074-binary-search.html" class="navigation-list-link">SE-0074 Implementation of Binary Search functions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0075-import-test.html" class="navigation-list-link">SE-0075 Adding a Build Configuration Import Test</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0076-copying-to-unsafe-mutable-pointer-with-unsafe-pointer-source.html" class="navigation-list-link">SE-0076 Add overrides taking an UnsafePointer source to non-destructive copying methods on UnsafeMutablePointer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0077-operator-precedence.html" class="navigation-list-link">SE-0077 Improved operator declarations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0078-rotate-algorithm.html" class="navigation-list-link">SE-0078 Implement a rotate algorithm, equivalent to std::rotate() in C++</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0079-upgrade-self-from-weak-to-strong.html" class="navigation-list-link">SE-0079 Allow using optional binding to upgrade `self` from a weak to strong reference</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0080-failable-numeric-initializers.html" class="navigation-list-link">SE-0080 Failable Numeric Conversion Initializers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0081-move-where-expression.html" class="navigation-list-link">SE-0081 Move `where` clause to end of declaration</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0082-swiftpm-package-edit.html" class="navigation-list-link">SE-0082 Package Manager Editable Packages</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0083-remove-bridging-from-dynamic-casts.html" class="navigation-list-link">SE-0083 Remove bridging conversion behavior from dynamic casts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0084-trailing-commas.html" class="navigation-list-link">SE-0084 Allow trailing commas in parameter lists and tuples</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0085-package-manager-command-name.html" class="navigation-list-link">SE-0085 Package Manager Command Names</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0086-drop-foundation-ns.html" class="navigation-list-link">SE-0086 Drop NS Prefix in Swift Foundation</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0087-lazy-attribute.html" class="navigation-list-link">SE-0087 Rename `lazy` to `@lazy`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0088-libdispatch-for-swift3.html" class="navigation-list-link">SE-0088 Modernize libdispatch for Swift 3 naming conventions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0089-rename-string-reflection-init.html" class="navigation-list-link">SE-0089 Renaming `String.init<T>(_: T)`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0090-remove-dot-self.html" class="navigation-list-link">SE-0090 Remove `.self` and freely allow type references in expressions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0091-improving-operators-in-protocols.html" class="navigation-list-link">SE-0091 Improving operator requirements in protocols</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0092-typealiases-in-protocols.html" class="navigation-list-link">SE-0092 Typealiases in protocols and protocol extensions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0093-slice-base.html" class="navigation-list-link">SE-0093 Adding a public `base` property to slices</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0094-sequence-function.html" class="navigation-list-link">SE-0094 Add sequence(first:next:) and sequence(state:next:) to the stdlib</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0095-any-as-existential.html" class="navigation-list-link">SE-0095 Replace `protocol<P1,P2>` syntax with `P1 & P2` syntax</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0096-dynamictype.html" class="navigation-list-link">SE-0096 Converting `dynamicType` from a property to an operator</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0097-negative-attributes.html" class="navigation-list-link">SE-0097 Normalizing naming for "negative" attributes</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0098-didset-capitalization.html" class="navigation-list-link">SE-0098 Lowercase `didSet` and `willSet` for more consistent keyword casing</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0099-conditionclauses.html" class="navigation-list-link">SE-0099 Restructuring Condition Clauses</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0100-add-sequence-based-init-and-merge-to-dictionary.html" class="navigation-list-link">SE-0100 Add sequence-based initializers and merge methods to Dictionary</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0101-standardizing-sizeof-naming.html" class="navigation-list-link">SE-0101 Reconfiguring `sizeof` and related functions into a unified `MemoryLayout` struct</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0102-noreturn-bottom-type.html" class="navigation-list-link">SE-0102 Remove `@noreturn` attribute and introduce an empty `Never` type</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0103-make-noescape-default.html" class="navigation-list-link">SE-0103 Make non-escaping closures the default</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0104-improved-integers.html" class="navigation-list-link">SE-0104 Protocol-oriented integers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0105-remove-where-from-forin-loops.html" class="navigation-list-link">SE-0105 Removing Where Clauses from For-In Loops</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0106-rename-osx-to-macos.html" class="navigation-list-link">SE-0106 Add a `macOS` Alias for the `OSX` Platform Configuration Test</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0107-unsaferawpointer.html" class="navigation-list-link">SE-0107 UnsafeRawPointer API</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0108-remove-assoctype-inference.html" class="navigation-list-link">SE-0108 Remove associated type inference</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0109-remove-boolean.html" class="navigation-list-link">SE-0109 Remove the `Boolean` protocol </a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0110-distingish-single-tuple-arg.html" class="navigation-list-link">SE-0110 Distinguish between single-tuple and multiple-argument function types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0111-remove-arg-label-type-significance.html" class="navigation-list-link">SE-0111 Remove type system significance of function argument labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0112-nserror-bridging.html" class="navigation-list-link">SE-0112 Improved NSError Bridging</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0113-rounding-functions-on-floatingpoint.html" class="navigation-list-link">SE-0113 Add integral rounding functions to FloatingPoint</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0114-buffer-naming.html" class="navigation-list-link">SE-0114 Updating Buffer "Value" Names to "Header" Names</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0115-literal-syntax-protocols.html" class="navigation-list-link">SE-0115 Rename Literal Syntax Protocols</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0116-id-as-any.html" class="navigation-list-link">SE-0116 Import Objective-C `id` as Swift `Any` type</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0117-non-public-subclassable-by-default.html" class="navigation-list-link">SE-0117 Allow distinguishing between public access and public overridability</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0118-closure-parameter-names-and-labels.html" class="navigation-list-link">SE-0118 Closure Parameter Names and Labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0119-extensions-access-modifiers.html" class="navigation-list-link">SE-0119 Remove access modifiers from extensions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0120-revise-partition-method.html" class="navigation-list-link">SE-0120 Revise `partition` Method Signature</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0121-remove-optional-comparison-operators.html" class="navigation-list-link">SE-0121 Remove `Optional` Comparison Operators</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0122-use-colons-for-subscript-type-declarations.html" class="navigation-list-link">SE-0122 Use colons for subscript declarations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0123-disallow-value-to-optional-coercion-in-operator-arguments.html" class="navigation-list-link">SE-0123 Disallow coercion to optionals in operator arguments</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0124-bitpattern-label-for-int-initializer-objectidentfier.html" class="navigation-list-link">SE-0124 `Int.init(ObjectIdentifier)` and `UInt.init(ObjectIdentifier)` should have a `bitPattern:` label</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0125-remove-nonobjectivecbase.html" class="navigation-list-link">SE-0125 Remove `NonObjectiveCBase` and `isUniquelyReferenced`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0126-refactor-metatypes-repurpose-t-dot-self-and-mirror.html" class="navigation-list-link">SE-0126 Refactor Metatypes, repurpose `T.self` and `Mirror`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0127-cleaning-up-stdlib-ptr-buffer.html" class="navigation-list-link">SE-0127 Cleaning up stdlib Pointer and Buffer Routines</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0128-unicodescalar-failable-initializer.html" class="navigation-list-link">SE-0128 Change failable UnicodeScalar initializers to failable</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0129-package-manager-test-naming-conventions.html" class="navigation-list-link">SE-0129 Package Manager Test Naming Conventions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0130-string-initializers-cleanup.html" class="navigation-list-link">SE-0130 Replace repeating `Character` and `UnicodeScalar` forms of String.init</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0131-anyhashable.html" class="navigation-list-link">SE-0131 Add `AnyHashable` to the standard library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0132-sequence-end-ops.html" class="navigation-list-link">SE-0132 Rationalizing Sequence end-operation names</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0133-rename-flatten-to-joined.html" class="navigation-list-link">SE-0133 Rename `flatten()` to `joined()`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0134-rename-string-properties.html" class="navigation-list-link">SE-0134 Rename two UTF8-related properties on String</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0135-package-manager-support-for-differentiating-packages-by-swift-version.html" class="navigation-list-link">SE-0135 Package Manager Support for Differentiating Packages by Swift version</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0136-memory-layout-of-values.html" class="navigation-list-link">SE-0136 Memory layout of values</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0137-avoiding-lock-in.html" class="navigation-list-link">SE-0137 Avoiding Lock-In to Legacy Protocol Designs</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0138-unsaferawbufferpointer.html" class="navigation-list-link">SE-0138 UnsafeRawBufferPointer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0139-bridge-nsnumber-and-nsvalue.html" class="navigation-list-link">SE-0139 Bridge Numeric Types to `NSNumber` and Cocoa Structs to `NSValue`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0140-bridge-optional-to-nsnull.html" class="navigation-list-link">SE-0140 Warn when `Optional` converts to `Any`, and bridge `Optional` As Its Payload Or `NSNull`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0141-available-by-swift-version.html" class="navigation-list-link">SE-0141 Availability by Swift version</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0142-associated-types-constraints.html" class="navigation-list-link">SE-0142 Permit where clauses to constrain associated types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0143-conditional-conformances.html" class="navigation-list-link">SE-0143 Conditional conformances</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0144-allow-single-dollar-sign-as-valid-identifier.html" class="navigation-list-link">SE-0144 Allow Single Dollar Sign as a Valid Identifier</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0145-package-manager-version-pinning.html" class="navigation-list-link">SE-0145 Package Manager Version Pinning</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0146-package-manager-product-definitions.html" class="navigation-list-link">SE-0146 Package Manager Product Definitions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0147-move-unsafe-initialize-from.html" class="navigation-list-link">SE-0147 Move UnsafeMutablePointer.initialize(from:) to UnsafeMutableBufferPointer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0148-generic-subscripts.html" class="navigation-list-link">SE-0148 Generic Subscripts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0149-package-manager-top-of-tree.html" class="navigation-list-link">SE-0149 Package Manager Support for Top of Tree development</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0150-package-manager-branch-support.html" class="navigation-list-link">SE-0150 Package Manager Support for branches</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0151-package-manager-swift-language-compatibility-version.html" class="navigation-list-link">SE-0151 Package Manager Swift Language Compatibility Version</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0152-package-manager-tools-version.html" class="navigation-list-link">SE-0152 Package Manager Tools Version</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0153-compensate-for-the-inconsistency-of-nscopyings-behaviour.html" class="navigation-list-link">SE-0153 Compensate for the inconsistency of `@NSCopying`'s behaviour</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0154-dictionary-key-and-value-collections.html" class="navigation-list-link">SE-0154 Provide Custom Collections for Dictionary Keys and Values</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0155-normalize-enum-case-representation.html" class="navigation-list-link">SE-0155 Normalize Enum Case Representation</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0156-subclass-existentials.html" class="navigation-list-link">SE-0156 Class and Subtype existentials</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0157-recursive-protocol-constraints.html" class="navigation-list-link">SE-0157 Support recursive constraints on associated types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0158-package-manager-manifest-api-redesign.html" class="navigation-list-link">SE-0158 Package Manager Manifest API Redesign</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0159-fix-private-access-levels.html" class="navigation-list-link">SE-0159 Fix Private Access Levels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0160-objc-inference.html" class="navigation-list-link">SE-0160 Limiting `@objc` inference</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0161-key-paths.html" class="navigation-list-link">SE-0161 Smart KeyPaths: Better Key-Value Coding for Swift</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0162-package-manager-custom-target-layouts.html" class="navigation-list-link">SE-0162 Package Manager Custom Target Layouts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0163-string-revision-1.html" class="navigation-list-link">SE-0163 String Revision: Collection Conformance, C Interop, Transcoding</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0164-remove-final-support-in-protocol-extensions.html" class="navigation-list-link">SE-0164 Remove final support in protocol extensions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0165-dict.html" class="navigation-list-link">SE-0165 Dictionary & Set Enhancements</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0166-swift-archival-serialization.html" class="navigation-list-link">SE-0166 Swift Archival & Serialization</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0167-swift-encoders.html" class="navigation-list-link">SE-0167 Swift Encoders</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0168-multi-line-string-literals.html" class="navigation-list-link">SE-0168 Multi-Line String Literals</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0169-improve-interaction-between-private-declarations-and-extensions.html" class="navigation-list-link">SE-0169 Improve Interaction Between `private` Declarations and Extensions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0170-nsnumber_bridge.html" class="navigation-list-link">SE-0170 NSNumber bridging and Numeric types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0171-reduce-with-inout.html" class="navigation-list-link">SE-0171 Reduce with `inout`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0172-one-sided-ranges.html" class="navigation-list-link">SE-0172 One-sided Ranges</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0173-swap-indices.html" class="navigation-list-link">SE-0173 Add `MutableCollection.swapAt(_:_:)`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0174-filter-range-replaceable.html" class="navigation-list-link">SE-0174 Change `filter` to return an associated type</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0175-package-manager-revised-dependency-resolution.html" class="navigation-list-link">SE-0175 Package Manager Revised Dependency Resolution</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0176-enforce-exclusive-access-to-memory.html" class="navigation-list-link">SE-0176 Enforce Exclusive Access to Memory</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0177-add-clamped-to-method.html" class="navigation-list-link">SE-0177 Add clamp(to:) to the stdlib</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0178-character-unicode-view.html" class="navigation-list-link">SE-0178 Add `unicodeScalars` property to `Character`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0179-swift-run-command.html" class="navigation-list-link">SE-0179 Swift `run` Command</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0180-string-index-overhaul.html" class="navigation-list-link">SE-0180 String Index Overhaul</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0181-package-manager-cpp-language-version.html" class="navigation-list-link">SE-0181 Package Manager C/C++ Language Standard Support</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0182-newline-escape-in-strings.html" class="navigation-list-link">SE-0182 String Newline Escaping</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0183-substring-affordances.html" class="navigation-list-link">SE-0183 Substring performance affordances</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0184-unsafe-pointers-add-missing.html" class="navigation-list-link">SE-0184 Unsafe[Mutable][Raw][Buffer]Pointer: add missing methods, adjust existing labels for clarity, and remove deallocation size</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0185-synthesize-equatable-hashable.html" class="navigation-list-link">SE-0185 Synthesizing `Equatable` and `Hashable` conformance</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0186-remove-ownership-keyword-support-in-protocols.html" class="navigation-list-link">SE-0186 Remove ownership keyword support in protocols</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0187-introduce-filtermap.html" class="navigation-list-link">SE-0187 Introduce Sequence.compactMap(_:)</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0188-stdlib-index-types-hashable.html" class="navigation-list-link">SE-0188 Make Standard Library Index Types Hashable</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0189-restrict-cross-module-struct-initializers.html" class="navigation-list-link">SE-0189 Restrict Cross-module Struct Initializers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0190-target-environment-platform-condition.html" class="navigation-list-link">SE-0190 Target environment platform condition</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0191-eliminate-indexdistance.html" class="navigation-list-link">SE-0191 Eliminate `IndexDistance` from `Collection`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0192-non-exhaustive-enums.html" class="navigation-list-link">SE-0192 Handling Future Enum Cases</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0193-cross-module-inlining-and-specialization.html" class="navigation-list-link">SE-0193 Cross-module inlining and specialization</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0194-derived-collection-of-enum-cases.html" class="navigation-list-link">SE-0194 Derived Collection of Enum Cases</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0195-dynamic-member-lookup.html" class="navigation-list-link">SE-0195 Introduce User-defined "Dynamic Member Lookup" Types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0196-diagnostic-directives.html" class="navigation-list-link">SE-0196 Compiler Diagnostic Directives</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0197-remove-where.html" class="navigation-list-link">SE-0197 Adding in-place `removeAll(where:)` to the Standard Library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0198-playground-quicklook-api-revamp.html" class="navigation-list-link">SE-0198 Playground QuickLook API Revamp #</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0199-bool-toggle.html" class="navigation-list-link">SE-0199 Adding `toggle` to `Bool`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0200-raw-string-escaping.html" class="navigation-list-link">SE-0200 Enhancing String Literals Delimiters to Support Raw Text</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0201-package-manager-local-dependencies.html" class="navigation-list-link">SE-0201 Package Manager Local Dependencies</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0202-random-unification.html" class="navigation-list-link">SE-0202 Random Unification</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0203-rename-sequence-elements-equal.html" class="navigation-list-link">SE-0203 Rename Sequence.elementsEqual</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0204-add-last-methods.html" class="navigation-list-link">SE-0204 Add `last(where:)` and `lastIndex(where:)` Methods</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0205-withUnsafePointer-for-lets.html" class="navigation-list-link">SE-0205 `withUnsafePointer(to:_:)` and `withUnsafeBytes(of:_:)` for immutable values</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0206-hashable-enhancements.html" class="navigation-list-link">SE-0206 Hashable Enhancements</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0207-containsOnly.html" class="navigation-list-link">SE-0207 Add an `allSatisfy` algorithm to `Sequence`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0208-package-manager-system-library-targets.html" class="navigation-list-link">SE-0208 Package Manager System Library Targets</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0209-package-manager-swift-lang-version-update.html" class="navigation-list-link">SE-0209 Package Manager Swift Language Version API Update</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0210-key-path-offset.html" class="navigation-list-link">SE-0210 Add an `offset(of:)` method to `MemoryLayout`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0211-unicode-scalar-properties.html" class="navigation-list-link">SE-0211 Add Unicode Properties to `Unicode.Scalar`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0212-compiler-version-directive.html" class="navigation-list-link">SE-0212 Compiler Version Directive</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0213-literal-init-via-coercion.html" class="navigation-list-link">SE-0213 Literal initialization via coercion</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0214-DictionaryLiteral.html" class="navigation-list-link">SE-0214 Renaming the `DictionaryLiteral` type to `KeyValuePairs`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0215-conform-never-to-hashable-and-equatable.html" class="navigation-list-link">SE-0215 Conform `Never` to `Equatable` and `Hashable`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0216-dynamic-callable.html" class="navigation-list-link">SE-0216 Introduce user-defined dynamically "callable" types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0217-bangbang.html" class="navigation-list-link">SE-0217 Introducing the `!!` "Unwrap or Die" operator to the Swift Standard Library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0218-introduce-compact-map-values.html" class="navigation-list-link">SE-0218 Introduce `compactMapValues` to Dictionary</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0219-package-manager-dependency-mirroring.html" class="navigation-list-link">SE-0219 Package Manager Dependency Mirroring</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0220-count-where.html" class="navigation-list-link">SE-0220 `count(where:)`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0221-character-properties.html" class="navigation-list-link">SE-0221 Character Properties</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0222-lazy-compactmap-sequence.html" class="navigation-list-link">SE-0222 Lazy CompactMap Sequence</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0223-array-uninitialized-initializer.html" class="navigation-list-link">SE-0223 Accessing an Array's Uninitialized Buffer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0224-ifswift-lessthan-operator.html" class="navigation-list-link">SE-0224 Support 'less than' operator in compilation conditions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0225-binaryinteger-iseven-isodd-ismultiple.html" class="navigation-list-link">SE-0225 Adding `isMultiple` to `BinaryInteger`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0226-package-manager-target-based-dep-resolution.html" class="navigation-list-link">SE-0226 Package Manager Target Based Dependency Resolution</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0227-identity-keypath.html" class="navigation-list-link">SE-0227 Identity key path</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0228-fix-expressiblebystringinterpolation.html" class="navigation-list-link">SE-0228 Fix `ExpressibleByStringInterpolation`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0229-simd.html" class="navigation-list-link">SE-0229 SIMD Vectors</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0230-flatten-optional-try.html" class="navigation-list-link">SE-0230 Flatten nested optionals resulting from 'try?'</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0231-optional-iteration.html" class="navigation-list-link">SE-0231 Optional Iteration</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0232-remove-customization-points.html" class="navigation-list-link">SE-0232 Remove Some Customization Points from the Standard Library's `Collection` Hierarchy</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0233-additive-arithmetic-protocol.html" class="navigation-list-link">SE-0233 Make `Numeric` Refine a new `AdditiveArithmetic` Protocol</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0234-remove-sequence-subsequence.html" class="navigation-list-link">SE-0234 Remove `Sequence.SubSequence`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0235-add-result.html" class="navigation-list-link">SE-0235 Add Result to the Standard Library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0236-package-manager-platform-deployment-settings.html" class="navigation-list-link">SE-0236 Package Manager Platform Deployment Settings</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0237-contiguous-collection.html" class="navigation-list-link">SE-0237 Introduce `withContiguous{Mutable}StorageIfAvailable` methods</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0238-package-manager-build-settings.html" class="navigation-list-link">SE-0238 Package Manager Target Specific Build Settings</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0239-codable-range.html" class="navigation-list-link">SE-0239 Add Codable conformance to Range types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0240-ordered-collection-diffing.html" class="navigation-list-link">SE-0240 Ordered Collection Diffing</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0241-string-index-explicit-encoding-offset.html" class="navigation-list-link">SE-0241 Deprecate String Index Encoded Offsets</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0242-default-values-memberwise.html" class="navigation-list-link">SE-0242 Synthesize default values for the memberwise initializer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0243-codepoint-and-character-literals.html" class="navigation-list-link">SE-0243 Integer-convertible character literals</a></li><li class="navigation-list-item active"><a href="http://localhost:4000/docs/2019-08-26-0244-opaque-result-types.html" class="navigation-list-link active">SE-0244 Opaque Result Types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0245-array-uninitialized-initializer.html" class="navigation-list-link">SE-0245 Add an Array Initializer with Access to Uninitialized Storage</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0246-mathable.html" class="navigation-list-link">SE-0246 Generic Math(s) Functions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0247-contiguous-strings.html" class="navigation-list-link">SE-0247 Contiguous Strings</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0248-string-gaps-missing-apis.html" class="navigation-list-link">SE-0248 String Gaps and Missing APIs</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0249-key-path-literal-function-expressions.html" class="navigation-list-link">SE-0249 Key Path Expressions as Functions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0250-swift-style-guide-and-formatter.html" class="navigation-list-link">SE-0250 Swift Code Style Guidelines and Formatter</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0251-simd-additions.html" class="navigation-list-link">SE-0251 SIMD additions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0252-keypath-dynamic-member-lookup.html" class="navigation-list-link">SE-0252 Key Path Member Lookup</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0253-callable.html" class="navigation-list-link">SE-0253 Introduce callables </a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0254-static-subscripts.html" class="navigation-list-link">SE-0254 Static and class subscripts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0255-omit-return.html" class="navigation-list-link">SE-0255 Implicit returns from single-expression functions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0256-contiguous-collection.html" class="navigation-list-link">SE-0256 Introduce `{Mutable}ContiguousCollection` protocol</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0257-elide-comma.html" class="navigation-list-link">SE-0257 Eliding commas from multiline expression lists</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-xxxx-synthesize-computed-property.html" class="navigation-list-link"> Feature name</a></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Swift Evolution List" aria-label="Search Swift Evolution List" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="//github.com/pondok-programmer/swift-evolution-jekyll">Swift Evolution List</a></li> </ul> </div> <div class="page"> <div id="main-content" class="page-content" role="main"> <h1 id="opaque-result-types"> <a href="#opaque-result-types" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Opaque Result Types </h1> <ul> <li>Proposal: <a href="0244-opaque-result-types.md">SE-0244</a></li> <li>Authors: <a href="https://github.com/DougGregor">Doug Gregor</a>, <a href="https://github.com/jckarter">Joe Groff</a></li> <li>Review Manager: <a href="https://github.com/airspeedswift">Ben Cohen</a></li> <li>Status: <strong>Active review (April 11 - April 17, 2019)</strong></li> <li>Implementation: <a href="https://github.com/apple/swift/pull/22072">apple/swift#22072</a></li> <li>Toolchain: https://github.com/apple/swift/pull/21137#issuecomment-468118328</li> <li>Previous revisions: (<a href="https://github.com/apple/swift-evolution/commit/e60bac23bf0d6f345ddb48fbf64ea8324fce79a9">1</a>)</li> <li>Previous review threads: https://forums.swift.org/t/se-0244-opaque-result-types/21252</li> </ul> <h2 id="introduction"> <a href="#introduction" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Introduction </h2> <p>This proposal is the first part of a group of changes were considering in a <a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814">design document for improving the UI of the generics model</a>. Well try to make this proposal stand alone to describe opaque return types, their design, and motivation, but we also recommend reading the design document for more in-depth exploration of the relationships among other features were considering. Well link to relevant parts of that document throughout this proposal.</p> <p>This specific proposal addresses the problem of <a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814#heading--missing-type-level-abstraction">type-level abstraction for returns</a>. Many libraries consist of composable generic components. For example, a graphics library might provide primitive types for basic shapes:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Shape</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">draw</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">Surface</span><span class="p">)</span>

  <span class="kd">func</span> <span class="n">collides</span><span class="o">&lt;</span><span class="kt">Other</span><span class="p">:</span> <span class="kt">Shape</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="kt">Other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Rectangle</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="kd">struct</span> <span class="kt">Circle</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</code></pre></div></div> <p>along with composable transformations to combine and modify primitive shapes into more complex ones:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Union</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">:</span> <span class="kt">Shape</span><span class="p">,</span> <span class="kt">B</span><span class="p">:</span> <span class="kt">Shape</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">a</span><span class="p">:</span> <span class="kt">A</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="kt">B</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Intersect</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">:</span> <span class="kt">Shape</span><span class="p">,</span> <span class="kt">B</span><span class="p">:</span> <span class="kt">Shape</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">a</span><span class="p">:</span> <span class="kt">A</span><span class="p">,</span> <span class="nv">b</span><span class="p">:</span> <span class="kt">B</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Transformed</span><span class="o">&lt;</span><span class="kt">S</span><span class="p">:</span> <span class="kt">Shape</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="kt">S</span>
  <span class="k">var</span> <span class="nv">transform</span><span class="p">:</span> <span class="kt">Matrix3x3</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <p>One could compose these transformations by using the existential type <code class="highlighter-rouge">Shape</code> instead of generic arguments, but doing so would imply more dynamism and runtime overhead than may be desired. If we directly compose the generic containers, maintaining the concrete types, then generic specialization can more readily optimize together the composed operations together, and the type system can also be used . A game or graphics app may want to define objects in terms of their shapes:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">GameObject</span> <span class="p">{</span>
  <span class="c1">// The shape of the object</span>
  <span class="kd">associatedtype</span> <span class="kt">Shape</span><span class="p">:</span> <span class="kt">Shapes</span><span class="o">.</span><span class="kt">Shape</span>

  <span class="k">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="kt">Shape</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>However, users of the <code class="highlighter-rouge">GameObject</code> protocol would now be burdened with writing out long, explicit types for their shapes:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">EightPointedStar</span><span class="p">:</span> <span class="kt">GameObject</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="kt">Union</span><span class="o">&lt;</span><span class="kt">Rectangle</span><span class="p">,</span> <span class="kt">Transformed</span><span class="o">&lt;</span><span class="kt">Rectangle</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">Union</span><span class="p">(</span><span class="kt">Rectangle</span><span class="p">(),</span> <span class="kt">Transformed</span><span class="p">(</span><span class="kt">Rectangle</span><span class="p">(),</span> <span class="nv">by</span><span class="p">:</span> <span class="o">.</span><span class="n">fortyFiveDegrees</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>This is unsightly because its verbose, but its also not very helpful for someone reading this declaration. The exact return type doesnt really matter, only the fact that it conforms to <code class="highlighter-rouge">Shape</code>. Spelling out the return type also effectively reveals most of the implementation of <code class="highlighter-rouge">shape</code>, making the declaration brittle; clients of <code class="highlighter-rouge">EightPointedStar</code> could end up relying on its exact return type, making it harder if the author of <code class="highlighter-rouge">EightPointedStar</code> wants to change how they implement its shape, such as if a future version of the library provides a generic <code class="highlighter-rouge">NPointedStar</code> primitive. Right now, if you want to abstract the return type of a declaration from its signature, existentials or manual type erasure are your only options, and these <a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814#heading--limits-of-existentials">come with tradeoffs</a> that are not always acceptable.</p> <h2 id="proposed-solution"> <a href="#proposed-solution" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Proposed solution </h2> <p>Instead of declaring the specific return type of <code class="highlighter-rouge">EightPointedStar.shape</code>s current implementation, all we really want to say is that it returns something that conforms to <code class="highlighter-rouge">Shape</code>. We propose the syntax <code class="highlighter-rouge">some Protocol</code>:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">EightPointedStar</span><span class="p">:</span> <span class="kt">GameObject</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="n">some</span> <span class="kt">Shape</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">Union</span><span class="p">(</span><span class="kt">Rectangle</span><span class="p">(),</span> <span class="kt">Transformed</span><span class="p">(</span><span class="kt">Rectangle</span><span class="p">(),</span> <span class="nv">by</span><span class="p">:</span> <span class="o">.</span><span class="n">fortyFiveDegrees</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>to declare that an <code class="highlighter-rouge">EightPointedStar</code> has some <code class="highlighter-rouge">Shape</code> without having to specify exactly what shape that is. The underlying concrete type is hidden, and can even change from one version of the library to the next without breaking those clients, because the underlying type identity is never exposed to clients. Unlike an existential, though, clients still have access to the type identity. This allows the library to provide a potentially-more-efficient design that leverages Swifts type system, without expanding the surface area of the library or making implementors of the librarys protocols rely on exposing verbose implementation types.</p> <p>An opaque type behaves like a <a href="https://forums.swift.org/t/reverse-generics-and-opaque-result-types/21608">reverse generic</a>. In a traditional generic function, the caller decides what types get bound to the callees generic arguments:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">generic</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Shape</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">T</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Rectangle</span> <span class="o">=</span> <span class="nf">generic</span><span class="p">()</span> <span class="c1">// T == Rectangle, chosen by caller</span>
<span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Circle</span> <span class="o">=</span> <span class="nf">generic</span><span class="p">()</span> <span class="c1">// T == Circle, chosen by caller</span>
</code></pre></div></div> <p>An opaque return type can be thought of as putting the generic signature to the right of the function arrow; instead of being a type chosen by the caller that the callee sees as abstracted, the return type is chosen by the callee, and comes back to the caller as abstracted:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Strawman syntax</span>
<span class="kd">func</span> <span class="nf">reverseGeneric</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Shape</span><span class="o">&gt;</span> <span class="kt">T</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">Rectangle</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">}</span>

<span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="nf">reverseGeneric</span><span class="p">()</span> <span class="c1">// abstracted type chosen by reverseGeneric's implementation</span>
</code></pre></div></div> <p>Reverse generics are a great mental model for understanding opaque return types, but the notation is admittedly awkward. We expect the common use case for this feature to be a single return value behind a set of protocol conformances, so were proposing to start with the more concise <code class="highlighter-rouge">some Shape</code> syntax:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Proposed syntax</span>
<span class="kd">func</span> <span class="nf">reverseGeneric</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">Shape</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">Rectangle</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="p">}</span>

<span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="nf">reverseGeneric</span><span class="p">()</span> <span class="c1">// abstracted type chosen by reverseGeneric's implementation</span>
</code></pre></div></div> <p>Following the <code class="highlighter-rouge">some</code> keyword is a set of constraints on the implicit generic type variable: a class, protocol, <code class="highlighter-rouge">Any</code>, <code class="highlighter-rouge">AnyObject</code>, or some composition thereof (joined with <code class="highlighter-rouge">&amp;</code>). This <code class="highlighter-rouge">some Protocol</code> sugar <a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814#heading--directly-expressing-constraints">can be generalized to generic arguments and structural positions in return types</a> in the future, and we could also eventually support a fully general generic signature for opaque returns. To enable incremental progress on the implementation, we propose starting by only supporting the <code class="highlighter-rouge">some</code> syntax in return position.</p> <h3 id="type-identity"> <a href="#type-identity" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Type identity </h3> <p>Generics give us an idea of what to expect from opaque return types. The return values from different calls to the same function have the same return type, like two variables of the same generic argument type:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">foo</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Equatable</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">T</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">Equatable</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">condition</span> <span class="o">=</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="c1">// OK to use ==, x and y are the same generic type T</span>
  <span class="k">return</span> <span class="n">condition</span> <span class="p">?</span> <span class="mi">1738</span> <span class="p">:</span> <span class="mi">679</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="nf">foo</span><span class="p">(</span><span class="s">"apples"</span><span class="p">,</span> <span class="s">"bananas"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">y</span> <span class="o">=</span> <span class="nf">foo</span><span class="p">(</span><span class="s">"apples"</span><span class="p">,</span> <span class="s">"some fruit nobody's ever heard of"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="c1">// also OK to use ==, x and y are the same opaque return type</span>
</code></pre></div></div> <p>If the opaque type exposes associated types, those associated types identities are also maintained. This allows the full API of protocols like the <code class="highlighter-rouge">Collection</code> family to be used:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">makeMeACollection</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">RangeReplaceableCollection</span> <span class="o">&amp;</span> <span class="kt">MutableCollection</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">var</span> <span class="nv">c</span> <span class="o">=</span> <span class="nf">makeMeACollection</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="mi">17</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">first</span><span class="o">!</span><span class="p">)</span> <span class="c1">// ok: it's a RangeReplaceableCollection</span>
<span class="n">c</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">startIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">first</span><span class="o">!</span> <span class="c1">// ok: it's a MutableCollection</span>
<span class="nf">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="nf">reversed</span><span class="p">())</span> <span class="c1">// ok: all Collection/Sequence operations are available</span>

<span class="kd">func</span> <span class="n">foo</span><span class="o">&lt;</span><span class="kt">C</span><span class="p">:</span> <span class="kt">Collection</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">_</span> <span class="p">:</span> <span class="kt">C</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="nf">foo</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c1">// ok: C inferred to opaque result type of makeMeACollection&lt;Int&gt;</span>
</code></pre></div></div> <p>Moreover, opaque result types preserve their identity when composed into other types, such as when forming a collection of the results:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">cc</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
<span class="n">cc</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c1">// ok: cc's Element == the result type of makeMeACollection&lt;Int&gt;</span>
<span class="k">var</span> <span class="nv">c2</span> <span class="o">=</span> <span class="nf">makeMeACollection</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="mi">38</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span> <span class="c1">// ok: Element == the result type of makeMeACollection&lt;Int&gt;</span>
</code></pre></div></div> <p>The opaque return type can however depend on the generic arguments going into the function when its called, so the return types of the same function invoked with different generic arguments are different:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">d</span> <span class="o">=</span> <span class="nf">makeMeACollection</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="s">"seventeen"</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">d</span> <span class="c1">// error: types or makeMeACollection&lt;Int&gt; and makeMeACollection&lt;String&gt; are different</span>
</code></pre></div></div> <p>Like a generic argument, the static type system does not consider the opaque type to be statically equivalent to the type it happens to be bound to:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">BinaryInteger</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">219</span> <span class="p">}</span>
<span class="k">var</span> <span class="nv">x</span> <span class="o">=</span> <span class="nf">foo</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">912</span> <span class="c1">// error: Int is not known to be the same as the return type as foo()</span>
</code></pre></div></div> <p>However, one can inspect an opaque types underlying type at runtime using dynamic casting:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="nf">foo</span><span class="p">()</span> <span class="k">as?</span> <span class="kt">Int</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"It's an Int, </span><span class="se">\(</span><span class="n">x</span><span class="se">)\n</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"Guessed wrong"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>In other words, like generic arguments, opaque result types are only opaque to the static type system. They dont have an independent existence at runtime.</p> <h3 id="implementing-a-function-returning-an-opaque-type"> <a href="#implementing-a-function-returning-an-opaque-type" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Implementing a function returning an opaque type </h3> <p>The implementation of a function returning an opaque type must return a value of the same concrete type <code class="highlighter-rouge">T</code> from each <code class="highlighter-rouge">return</code> statement, and <code class="highlighter-rouge">T</code> must meet all of the constraints stated on the opaque type. For example:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">P</span> <span class="p">{</span> <span class="p">}</span>
<span class="kd">extension</span> <span class="kt">Int</span> <span class="p">:</span> <span class="kt">P</span> <span class="p">{</span> <span class="p">}</span>
<span class="kd">extension</span> <span class="kt">String</span> <span class="p">:</span> <span class="kt">P</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">func</span> <span class="nf">f1</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s">"opaque"</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">f2</span><span class="p">(</span><span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span> <span class="c1">// ok: both returns produce Int</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="p">{</span> <span class="k">return</span> <span class="n">i</span> <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">f2</span><span class="p">(</span><span class="nv">flip</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">flip</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">17</span> <span class="p">}</span>
  <span class="k">return</span> <span class="s">"a string"</span> <span class="c1">// error: different return types Int and String</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">f3</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">return</span> <span class="mf">3.1419</span> <span class="c1">// error: Double does not conform to P</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">f4</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">p</span><span class="p">:</span> <span class="kt">P</span> <span class="o">=</span> <span class="s">"hello"</span>
  <span class="k">return</span> <span class="n">p</span> <span class="c1">// error: protocol type P does not conform to P</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">f5</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">f1</span><span class="p">()</span> <span class="c1">// ok: f1() returns an opaque type that conforms to P</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Initializable</span> <span class="p">{</span> <span class="nf">init</span><span class="p">()</span> <span class="p">}</span>

<span class="kd">func</span> <span class="n">f6</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">P</span> <span class="o">&amp;</span> <span class="kt">Initializable</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">_</span><span class="p">:</span> <span class="kt">T</span><span class="o">.</span><span class="k">Type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kt">T</span><span class="p">()</span> <span class="c1">// ok: T will always be a concrete type conforming to P</span>
<span class="p">}</span>
</code></pre></div></div> <p>These rules guarantee that there is a single concrete type produced by any call to the function. The concrete type can depend on the generic type arguments (as in the <code class="highlighter-rouge">f6()</code> example), but must be consistent across all <code class="highlighter-rouge">return</code> statements.</p> <p>Note that recursive calls <em>are</em> allowed, and are known to produce a value of the same concrete type, but that the concrete type itself is not known:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">f7</span><span class="p">(</span><span class="n">_</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">f7</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// ok: returning our own opaque result type</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="nf">f7</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="c1">// error: opaque result type of f7() is not convertible to Int</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="c1">// ok: grounds the recursion with a concrete type</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Of course, there must be at least one <code class="highlighter-rouge">return</code> statement that provides a concrete type.</p> <p>Note that a function cannot call itself recursively in a way that forms a type parameterized on the functions own opaque result type, since this would mean that the opaque type is infinitely recursive:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Wrapper</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">P</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">P</span> <span class="p">{</span> <span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">T</span> <span class="p">}</span>

<span class="kd">func</span> <span class="nf">f8</span><span class="p">(</span><span class="n">_</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
   <span class="c1">// invalid; this binds the opaque result type to Wrapper&lt;return type of f8&gt;,</span>
   <span class="c1">// which is Wrapper&lt;Wrapper&lt;return type of f8&gt;&gt;, which is</span>
   <span class="c1">// Wrapper&lt;Wrapper&lt;Wrapper&lt;...&gt;&gt;&gt;...</span>
  <span class="k">return</span> <span class="kt">Wrapper</span><span class="p">(</span><span class="nf">f8</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div> <p>A function with an opaque result type is also required to have a <code class="highlighter-rouge">return</code> statement even if it does not terminate:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">f9</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="nf">fatalError</span><span class="p">(</span><span class="s">"not implemented"</span><span class="p">)</span>

  <span class="c1">// error: no return statement to get opaque type</span>
<span class="p">}</span>
</code></pre></div></div> <p>This requirement is necessary because, even though <code class="highlighter-rouge">f9</code>s return value cannot be reached, the return type of <code class="highlighter-rouge">f9</code> can still be propagated by local type inference or generic instantiation in ways that dont require evaluating <code class="highlighter-rouge">f9</code>, so a type for <code class="highlighter-rouge">f9</code> must be available:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">delayedF9</span> <span class="o">=</span> <span class="p">{</span> <span class="nf">f9</span><span class="p">()</span> <span class="p">}</span> <span class="c1">// closure has type () -&gt; return type of f9</span>
</code></pre></div></div> <p>We cant necessarily default the underlying type to <code class="highlighter-rouge">Never</code>, since <code class="highlighter-rouge">Never</code> may not conform to the constraints of the opaque type. If <code class="highlighter-rouge">Never</code> does conform, and it is desired as the underlying return type, that can be written explicitly as a <code class="highlighter-rouge">return</code> statement:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">Never</span><span class="p">:</span> <span class="kt">P</span> <span class="p">{}</span>
<span class="kd">func</span> <span class="nf">f9b</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"not implemented"</span><span class="p">)</span> <span class="c1">// OK, explicitly binds return type to Never</span>
<span class="p">}</span>
</code></pre></div></div> <p>This restriction on non-terminating functions could be something we lift in the future, by synthesizing bottom-type conformances to the protocols required by the opaque type. We leave that as a future extension.</p> <h3 id="properties-and-subscripts"> <a href="#properties-and-subscripts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Properties and subscripts </h3> <p>Opaque result types can also be used with properties and subscripts:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">GameObject</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="n">some</span> <span class="kt">Shape</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>For computed properties, the concrete type is determined by the <code class="highlighter-rouge">return</code> statements in the getter. Opaque result types can also be used in stored properties that have an initializer, in which case the concrete type is the type of the initializer:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">strings</span><span class="p">:</span> <span class="n">some</span> <span class="kt">Collection</span> <span class="o">=</span> <span class="p">[</span><span class="s">"hello"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">]</span>
</code></pre></div></div> <p>Properties and subscripts of opaque result type can be mutable. For example:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Module A</span>
<span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">flip</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">struct</span> <span class="kt">Witness</span><span class="p">:</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">flip</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="k">var</span> <span class="nv">someP</span><span class="p">:</span> <span class="n">some</span> <span class="kt">P</span> <span class="o">=</span> <span class="kt">Witness</span><span class="p">()</span>

<span class="c1">// Module B</span>
<span class="kd">import</span> <span class="kt">A</span>
<span class="n">someP</span><span class="o">.</span><span class="nf">flip</span><span class="p">()</span> <span class="c1">// ok: flip is a mutating function called on a variable</span>
</code></pre></div></div> <p>With a subscript or a computed property, the type of the value provided to the setter (e.g., <code class="highlighter-rouge">newValue</code>) is determined by the <code class="highlighter-rouge">return</code> statements in the getter, so the type is consistent and known only to the implementation of the property or subscript. For example:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">P</span> <span class="p">{</span> <span class="p">}</span>
<span class="kd">private</span> <span class="kd">struct</span> <span class="kt">Impl</span><span class="p">:</span> <span class="kt">P</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Vendor</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="k">var</span> <span class="nv">storage</span><span class="p">:</span> <span class="p">[</span><span class="kt">Impl</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="cm">/* ... */</span><span class="p">]</span>

  <span class="kd">public</span> <span class="k">var</span> <span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">storage</span><span class="o">.</span><span class="n">count</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="nf">subscript</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">storage</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="nf">set</span> <span class="p">(</span><span class="n">newValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">storage</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">vendor</span> <span class="o">=</span> <span class="kt">Vendor</span><span class="p">()</span>
<span class="n">vendor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">vendor</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1">// ok: can move elements around</span>
</code></pre></div></div> <h3 id="associated-type-inference"> <a href="#associated-type-inference" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Associated type inference </h3> <p>While one can use type inference to declare variables of the opaque result type of a function, there is no direct way to name the opaque result type:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">f1</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>

<span class="k">let</span> <span class="nv">vf1</span> <span class="o">=</span> <span class="nf">f1</span><span class="p">()</span> <span class="c1">// type of vf1 is the opaque result type of f1()</span>
</code></pre></div></div> <p>However, type inference can deduce an opaque result type as the associated type of the protocol:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">GameObject</span> <span class="p">{</span>
  <span class="kd">associatedtype</span> <span class="kt">ObjectShape</span><span class="p">:</span> <span class="kt">Shape</span>

  <span class="k">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="kt">ObjectShape</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Player</span><span class="p">:</span> <span class="kt">GameObject</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">shape</span><span class="p">:</span> <span class="n">some</span> <span class="kt">Shape</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>

  <span class="c1">// infers typealias Shape = opaque result type of Player.shape</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">pos</span><span class="p">:</span> <span class="kt">Player</span><span class="o">.</span><span class="kt">ObjectShape</span> <span class="c1">// ok: names the opaque result type of S.someValue()</span>
<span class="n">pos</span> <span class="o">=</span> <span class="kt">Player</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span> <span class="c1">// ok: returns the same opaque result type</span>
</code></pre></div></div> <p>Note that having a name for the opaque result type still doesnt give information about the underlying concrete type. For example, the only way to create an instance of the type <code class="highlighter-rouge">S.SomeType</code> is by calling <code class="highlighter-rouge">S.someValue()</code>.</p> <p>Associated type inference can only infer an opaque result type for a non-generic requirement, because the opaque type is parameterized by the functions own generic arguments. For instance, in:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="kd">associatedtype</span> <span class="kt">A</span><span class="p">:</span> <span class="kt">P</span>
  <span class="kd">func</span> <span class="n">foo</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">P</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">A</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Foo</span><span class="p">:</span> <span class="kt">P</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="n">foo</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">P</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>there is no single underlying type to infer <code class="highlighter-rouge">A</code> to, because the return type of <code class="highlighter-rouge">foo</code> is allowed to change with <code class="highlighter-rouge">T</code>.</p> <h2 id="detailed-design"> <a href="#detailed-design" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Detailed design </h2> <h3 id="grammar-of-opaque-result-types"> <a href="#grammar-of-opaque-result-types" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Grammar of opaque result types </h3> <p>The grammatical production for opaque result types is straightforward:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type ::= opaque-type

opaque-type ::= 'some' type
</code></pre></div></div> <p>The <code class="highlighter-rouge">type</code> following the <code class="highlighter-rouge">'some'</code> keyword is semantically restricted to be a class or existential type, meaning it must consist only of <code class="highlighter-rouge">Any</code>, <code class="highlighter-rouge">AnyObject</code>, protocols, or base classes, possibly composed using <code class="highlighter-rouge">&amp;</code>. This type is used to describe the constraints on the implicit reverse generic parameter.</p> <h3 id="restrictions-on-opaque-result-types"> <a href="#restrictions-on-opaque-result-types" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Restrictions on opaque result types </h3> <p>Opaque result types can only be used as the result type of a function, the type of a variable, or the result type of a subscript. The opaque type must be the entire return type of the function, For example, one cannot return an optional opaque result type:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">f</span><span class="p">(</span><span class="nv">flip</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">some</span> <span class="kt">P</span><span class="p">)?</span> <span class="p">{</span> <span class="c1">// error: `some P` is not the entire return type</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <p>This restriction could be lifted in the future.</p> <p>More fundamentally, opaque result types cannot be used in the requirements of a protocol:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Q</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="c1">// error: cannot use opaque result type within a protocol</span>
<span class="p">}</span>
</code></pre></div></div> <p>Associated types provide a better way to model the same problem, and the requirements can then be satisfied by a function that produces an opaque result type. (There might be an interesting shorthand feature here, where using <code class="highlighter-rouge">some</code> in a protocol requirement implicitly introduces an associated type, but we leave that for future language design to explore.)</p> <p>Similarly to the restriction on protocols, opaque result types cannot be used for a non-<code class="highlighter-rouge">final</code> declaration within a class:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">C</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span> <span class="c1">// error: cannot use opaque result type with a non-final method</span>
  <span class="kd">final</span> <span class="kd">func</span> <span class="nf">g</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span> <span class="c1">// ok</span>
<span class="p">}</span>
</code></pre></div></div> <p>This restriction could conceivably be lifted in the future, but it would mean that override implementations would be constrained to returning the same type as their super implementation, meaning they must call <code class="highlighter-rouge">super.method()</code> to produce a valid return value.</p> <h3 id="uniqueness-of-opaque-result-types"> <a href="#uniqueness-of-opaque-result-types" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Uniqueness of opaque result types </h3> <p>Opaque result types are uniqued based on the function/property/subscript and any generic type arguments. For example:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">makeOpaque</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">_</span><span class="p">:</span> <span class="kt">T</span><span class="o">.</span><span class="k">Type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">Any</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="k">var</span> <span class="nv">x</span> <span class="o">=</span> <span class="nf">makeOpaque</span><span class="p">(</span><span class="kt">Int</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="nf">makeOpaque</span><span class="p">(</span><span class="kt">Double</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="c1">// error: "opaque" type from makeOpaque&lt;Double&gt; is distinct from makeOpaque&lt;Int&gt;</span>
</code></pre></div></div> <p>This includes any generic type arguments from outer contexts, e.g.,</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">Array</span> <span class="k">where</span> <span class="kt">Element</span><span class="p">:</span> <span class="kt">Comparable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">opaqueSorted</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">Sequence</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nv">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span> <span class="nf">opaqueSorted</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">]</span><span class="o">.</span><span class="nf">opaqueSorted</span><span class="p">()</span> <span class="c1">// error: opaque result types for [Int].opaqueSorted() and [String].opaqueSorted() differ</span>
</code></pre></div></div> <h3 id="implementation-strategy"> <a href="#implementation-strategy" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Implementation strategy </h3> <p>From an implementation standpoint, a client of a function with an opaque result type needs to treat values of that result type like any other resilient value type: its size, alignment, layout, and operations are unknown.</p> <p>However, when the body of the function is known to the client (e.g., due to inlining or because the client is in the same compilation unit as the function), the compilers optimizer will have access to the specific concrete type, eliminating the indirection cost of the opaque result type.</p> <h2 id="source-compatibility"> <a href="#source-compatibility" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Source compatibility </h2> <p>Opaque result types are purely additive. They can be used as a tool to improve long-term source (and binary) stability, by not exposing the details of a result type to clients.</p> <p>If opaque result types are retroactively adopted in a library, it would initially break source compatibility (e.g., if types like <code class="highlighter-rouge">EnumeratedSequence</code>, <code class="highlighter-rouge">FlattenSequence</code>, and <code class="highlighter-rouge">JoinedSequence</code> were removed from the public API) but could provide longer-term benefits for both source and ABI stability because fewer details would be exposed to clients. There are some mitigations for source compatibility, e.g., a longer deprecation cycle for the types or overloading the old signature (that returns the named types) with the new signature (that returns an opaque result type).</p> <h2 id="effect-on-abi-stability"> <a href="#effect-on-abi-stability" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Effect on ABI stability </h2> <p>Opaque result types are an ABI-additive feature, so do not in and of themselves impact existing ABI. However, additional runtime support is however needed to support instantiating opaque result types across ABI boundaries, meaning that <em>a Swift 5.1 runtime will be required to deploy code that uses opaque types in public API</em>. Also, changing an existing API to make use of opaque result types instead of returning concrete types would be an ABI-breaking change, so one of the source compatibility mitigations mentioned above would also need to be deployed to maintain ABI compatibility with existing binary clients.</p> <h2 id="effect-on-api-resilience"> <a href="#effect-on-api-resilience" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Effect on API resilience </h2> <p>Opaque result types are part of the result type of a function/type of a variable/element type of a subscript. The requirements that describe the opaque result type cannot change without breaking the API/ABI. However, the underlying concrete type <em>can</em> change from one version to the next without breaking ABI, because that type is not known to clients of the API.</p> <p>One notable exception to the above rule is <code class="highlighter-rouge">@inlinable</code>: an <code class="highlighter-rouge">@inlinable</code> declaration with an opaque result type requires that the underlying concrete type be <code class="highlighter-rouge">public</code> or <code class="highlighter-rouge">@usableFromInline</code>. Moreover, the underlying concrete type <em>cannot be changed</em> without breaking backward compatibility, because its identity has been exposed by inlining the body of the function. That makes opaque result types somewhat less compelling for the <code class="highlighter-rouge">compactMap</code> example presented in the introduction, because one cannot have <code class="highlighter-rouge">compactMap</code> be marked <code class="highlighter-rouge">@inlinable</code> with an opaque result type, and then later change the underlying concrete type to something more efficient.</p> <p>We could allow an API originally specified using an opaque result type to later evolve to specify the specific result type. The result type itself would have to become visible to clients, and this might affect source compatibility, but (mangled name aside) such a change would be resilient.</p> <h2 id="rusts-impl-trait"> <a href="#rusts-impl-trait" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Rusts <code class="highlighter-rouge">impl Trait</code> </h2> <p>The proposed Swift feature is largely inspired by Rusts <code class="highlighter-rouge">impl Trait</code> language feature, described by <a href="https://github.com/rust-lang/rfcs/blob/master/text/1522-conservative-impl-trait.md">Rust RFC 1522</a> and extended by <a href="https://github.com/rust-lang/rfcs/blob/master/text/1951-expand-impl-trait.md">Rust RFC 1951</a>. There are only a small number of differences between this feature as expressed in Swift vs. Rusts <code class="highlighter-rouge">impl Trait</code> as described in RFC 1522:</p> <ul> <li>Swifts need for a stable ABI necessitates translation of opaque result types as resilient types, which is unnecessary in Rusts model, where the concrete type can always be used for code generation.</li> <li>Swifts opaque result types are fully opaque, because Swift doesnt have pass-through protocols like Rusts <code class="highlighter-rouge">Send</code> trait, which simplifies the type checking problem slightly.</li> <li>Due to associated type inference, Swift already has a way to name an opaque result type in some cases.</li> </ul> <h2 id="alternatives-considered"> <a href="#alternatives-considered" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Alternatives considered </h2> <h3 id="return-type-inference"> <a href="#return-type-inference" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Return type inference </h3> <p>Part of the motivation of this feature is to avoid having to spell out elaborate return types. This proposal achieves that for types that can be abstracted behind protocols, but in doing so introduces complexity in the form of a new kind of reverse generic type. Meanwhile, there are kinds of verbose return types that cant be effectively hidden behind protocol interfaces, like deeply nested collections:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">jsonBlob</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="p">[[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]]]]</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div></div> <p>We could theoretically address the verbosity problem in its full generality and without introducing new type system features by allowing return types to be inferred, like C++14s or Ds <code class="highlighter-rouge">auto</code> return types:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">jsonBlob</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">auto</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div></div> <p>Although this would superficially address the problem of verbose return types, that isnt really the primary problem this proposal is trying to solve, which is to allow for <em>more precise description of interfaces</em>. The case of a verbose composed generic adapter type is fundamentally different from a deeply nested collection; in the former case, the concrete type is not only verbose, but its largely irrelevant, because clients should only care about the common protocols the type conforms to. For a nested collection, the verbose type <em>is</em> the interface: the full type is necessary to fully describe how someone interacts with that collection.</p> <p>Return type inference also has several undesirable traits as a language feature:</p> <ul> <li>It violates separate compilation of function bodies, since the body of the function must be type-checked to infer the return type. Swift already has type inference for stored property declarations, and we consider this a mistake, since it has been an ongoing source of implementation complexity and performance problems due to the need to type-check the property initializer across files. This is not a problem for opaque return types, because callers only interface with the declaration through the opaque types constraints. Code can be compiled against a function with an opaque return type without having to know what the underlying type is; it is just an optimization to specialize away the opaque type when the underlying type is known.</li> <li>Similarly, inferred return types wouldnt provide any semantic abstraction once the type is inferred. Code that calls the function would still see the full concrete type, allowing clients to rely on unintentional details of the concrete type, and the implementation would be bound by ABI and source compatibility constraints if it needed to change the return type. Module interfaces and documentation would also still expose the full return type, meaning they dont get the benefit of the shorter notation.</li> </ul> <p>We see opaque return types as not only sugar for syntactically heavy return types, but also a tool for writing clearer, more resilient APIs. Return type inference would achieve the former but not the latter, while also introducing another compile-time performance footgun into the language.</p> <h3 id="syntax-for-opaque-return-types"> <a href="#syntax-for-opaque-return-types" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Syntax for opaque return types </h3> <p>This proposal suggests the word <code class="highlighter-rouge">some</code> to introduce opaque return types, since it has the right connotation by analogy to <code class="highlighter-rouge">Any</code> which is used to describe dynamically type-erased containers (and has been proposed to be a general way of referring to existential types)a function that has an opaque return type returns <em>some</em> specific type that conforms to the given constraints, whereas an existential can contain <em>any</em> type dynamically at any point in time. The spelling would also work well if <a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814#heading--directly-expressing-constraints">generalized to implicit generic arguments</a> in the future. There are nonetheless reasonable objections to this keyword:</p> <ul> <li><code class="highlighter-rouge">some</code> is already used in the language as one of the case names for <code class="highlighter-rouge">Optional</code>; it is rare to need to spell <code class="highlighter-rouge">Optional.some</code> or <code class="highlighter-rouge">.some</code> explicitly, but it could nonetheless introduce confusion.</li> <li>In spoken language, <code class="highlighter-rouge">some type</code> and <code class="highlighter-rouge">sum type</code> sound the same.</li> <li><code class="highlighter-rouge">swift some</code> could be a difficult term to search for. (However, on Google it currently gives <a href="https://www.google.com/search?client=safari&amp;rls=en&amp;q=swift+some&amp;ie=UTF-8&amp;oe=UTF-8">reasonable results</a> about Optional in Swift.)</li> </ul> <p>Another obvious candidate is <code class="highlighter-rouge">opaque</code>, following the title of this very proposal. The word opaque is itself an overloaded term with existing meaning in many domains, which is unfortunate:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Shape</span> <span class="p">{}</span>

<span class="kd">func</span> <span class="nf">translucentRectangle</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">opaque</span> <span class="kt">Shape</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</code></pre></div></div> <p>The term opaque is also fairly heavily overloaded in the Swift implementation (albeit not so much the source-level programming model). It may be that there is a better term, such as abstract return types, to refer to this feature in its entirety. <code class="highlighter-rouge">opaque</code> is also not as good a fit for generalization to implicit generic arguments.</p> <p>In swift-evolution discussion, several other names came up, including:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func translucentRectangle() -&gt; unspecified Shape { ... }

func translucentRectangle() -&gt; anyOld Shape { ... }

func translucentRectangle() -&gt; hazyButSpecific Shape { ... }

func translucentRectangle() -&gt; someSpecific Shape { ... }

func translucentRectangle() -&gt; someConcrete Shape { ... }

func translucentRectangle() -&gt; nonspecific Shape { ... }

func translucentRectangle() -&gt; unclear Shape { ... }

func translucentRectangle() -&gt; arbitrary Shape { ... }

func translucentRectangle() -&gt; someThing Shape { ... }

func translucentRectangle() -&gt; anonymized Shape { ... }

func translucentRectangle() -&gt; nameless Shape { ... }
</code></pre></div></div> <p>In our opinion, most of these are longer and not much clearer, and many wouldnt work well as generalized sugar for arguments and returns.</p> <h3 id="opaque-type-aliases"> <a href="#opaque-type-aliases" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Opaque type aliases </h3> <p>As proposed, opaque result types are tied to a specific declaration. They offer no way to state that two related APIs with opaque result types produce the <em>same</em> underlying concrete type. The idea of reverse generics could however be decoupled from function declarations, if you could write an opaque typealias that describes the abstracted interface to a type, while giving it a name, then you could express that relationship across declarations. For example:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">LazyCompactMapCollection</span><span class="o">&lt;</span><span class="kt">Elements</span><span class="p">,</span> <span class="kt">ElementOfResult</span><span class="o">&gt;</span>
  <span class="o">-&gt;</span> <span class="o">&lt;</span><span class="kt">C</span><span class="p">:</span> <span class="kt">Collection</span><span class="o">&gt;</span> <span class="kt">C</span> <span class="k">where</span> <span class="kt">C</span><span class="o">.</span><span class="kt">Element</span> <span class="o">==</span> <span class="kt">ElementOfResult</span>
  <span class="o">=</span> <span class="kt">LazyMapSequence</span><span class="o">&lt;</span><span class="kt">LazyFilterSequence</span><span class="o">&lt;</span><span class="kt">LazyMapSequence</span><span class="o">&lt;</span><span class="kt">Elements</span><span class="p">,</span> <span class="kt">ElementOfResult</span><span class="p">?</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="kt">ElementOfResult</span><span class="o">&gt;</span>
</code></pre></div></div> <p>In this strawman syntax, the reverse generic signature following the <code class="highlighter-rouge">-&gt;</code> is how clients see <code class="highlighter-rouge">LazyCompactMapCollection</code>. The underlying concrete type, spelled after the <code class="highlighter-rouge">=</code>, is visible only to the implementation (in some way that would have to be designed). With this feature, multiple APIs could be described as returning a <code class="highlighter-rouge">LazyCompactMapCollection</code>:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">LazyMapCollection</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">func</span> <span class="n">compactMap</span><span class="o">&lt;</span><span class="kt">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">transform</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">U</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">LazyCompactMapCollection</span><span class="o">&lt;</span><span class="kt">Base</span><span class="p">,</span> <span class="kt">U</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
 <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">func</span> <span class="nf">filter</span><span class="p">(</span><span class="n">_</span> <span class="nv">isIncluded</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">LazyCompactMapCollection</span><span class="o">&lt;</span><span class="kt">Base</span><span class="p">,</span> <span class="kt">Element</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>From the client perspective, both APIs would return the same type, but the specific underlying type would not be known.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">compactMapOp</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="kd">lazy</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="nf">compactMap</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="k">if</span> <span class="kt">Bool</span><span class="o">.</span><span class="nf">random</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">compactMapOp</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="kd">lazy</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>  <span class="c1">// ok: both APIs have the same type</span>
<span class="p">}</span>
</code></pre></div></div> <p>This would be a great feature to explore as a future direction, since it has some important benefits relative to opaque result types. However, we dont think its the best place to start with this feature. Compare a declaration using opaque typealiases like:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">foo</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">ReturnTypeOfFoo</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span> <span class="p">}</span>

<span class="n">opaque</span> <span class="kd">typealias</span> <span class="kt">ReturnTypeOfFoo</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="o">-&gt;</span> <span class="o">&lt;</span><span class="kt">U</span><span class="p">:</span> <span class="kt">P</span><span class="o">&gt;</span> <span class="kt">P</span> <span class="o">=</span> <span class="kt">Int</span>
</code></pre></div></div> <p>to one using opaque return types:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="n">foo</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">some</span> <span class="kt">P</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span> <span class="p">}</span>
</code></pre></div></div> <p>The one using opaque typealiases requires an intermediate name, which one must read and follow to its definition to understand the interface of <code class="highlighter-rouge">foo</code>. The definition of <code class="highlighter-rouge">ReturnTypeOfFoo</code> also needs to spell out the underlying concrete return type of <code class="highlighter-rouge">foo</code>, and the two declarations are tightly coupled; a change to <code class="highlighter-rouge">foo</code> will likely require a lockstep change to <code class="highlighter-rouge">ReturnTypeOfFoo</code>. We expect that, in the common use case for this feature, the types being abstracted are going to be tied to specific declarations, and there wouldnt be any better name to really give than return type of (decl), so making opaque type aliases the only way of expressing return type abstraction would introduce a lot of obscuring boilerplate.</p> <h2 id="future-directions"> <a href="#future-directions" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Future Directions </h2> <p>As noted in the introduction, this proposal is the first part of a group of changes were considering in a <a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814">design document for improving the UI of the generics model</a>. That design document lays out a number of related directions we can go based on the foundation establised by this proposal, including:</p> <ul> <li>allowing <a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814#heading--reverse-generics">fully generalized reverse generics</a></li> <li><a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814#heading--directly-expressing-constraints">generalizing the <code class="highlighter-rouge">some</code> syntax</a> as shorthand for generic arguments, and allowing structural use in generic returns</li> <li><a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814#heading--directly-expressing-constraints">more compact constraint syntax</a> that can also work with generalized existentials</li> <li>introducing <a href="https://forums.swift.org/t/improving-the-ui-of-generics/22814#heading--clarifying-existentials"><code class="highlighter-rouge">any</code> as a dual to <code class="highlighter-rouge">some</code></a> for explicitly spelling existential types</li> </ul> <p>We recommend reading that document for a more in-depth exploration of these related ideas.</p> </div> </div> </div> </div> </body> </html>
