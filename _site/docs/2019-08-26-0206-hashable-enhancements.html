<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>SE-0206 Hashable Enhancements - Swift Evolution List</title> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>SE-0206 Hashable Enhancements | Swift Evolution List</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="SE-0206 Hashable Enhancements" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Yuhuu!" /> <meta property="og:description" content="Yuhuu!" /> <link rel="canonical" href="http://localhost:4000/docs/2019-08-26-0206-hashable-enhancements.html" /> <meta property="og:url" content="http://localhost:4000/docs/2019-08-26-0206-hashable-enhancements.html" /> <meta property="og:site_name" content="Swift Evolution List" /> <script type="application/ld+json"> {"url":"http://localhost:4000/docs/2019-08-26-0206-hashable-enhancements.html","headline":"SE-0206 Hashable Enhancements","description":"Yuhuu!","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000" class="site-title lh-tight">Swift Evolution List</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="http://localhost:4000/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="http://localhost:4000/" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="http://localhost:4000/about/" class="navigation-list-link">About</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0001-keywords-as-argument-labels.html" class="navigation-list-link">SE-0001 Allow (most) keywords as argument labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0002-remove-currying.html" class="navigation-list-link">SE-0002 Removing currying `func` declaration syntax</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0003-remove-var-parameters.html" class="navigation-list-link">SE-0003 Removing `var` from Function Parameters</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0004-remove-pre-post-inc-decrement.html" class="navigation-list-link">SE-0004 Remove the `++` and `--` operators</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0005-objective-c-name-translation.html" class="navigation-list-link">SE-0005 Better Translation of Objective-C APIs Into Swift</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0006-apply-api-guidelines-to-the-standard-library.html" class="navigation-list-link">SE-0006 Apply API Guidelines to the Standard Library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0007-remove-c-style-for-loops.html" class="navigation-list-link">SE-0007 Remove C-style for-loops with conditions and incrementers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0008-lazy-flatmap-for-optionals.html" class="navigation-list-link">SE-0008 Add a Lazy flatMap for Sequences of Optionals #</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0009-require-self-for-accessing-instance-members.html" class="navigation-list-link">SE-0009 Require self for accessing instance members</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0010-add-staticstring-unicodescalarview.html" class="navigation-list-link">SE-0010 Add StaticString.UnicodeScalarView</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0011-replace-typealias-associated.html" class="navigation-list-link">SE-0011 Replace `typealias` keyword with `associatedtype` for associated type declarations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0012-add-noescape-to-public-library-api.html" class="navigation-list-link">SE-0012 Add `@noescape` to public library API</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0013-remove-partial-application-super.html" class="navigation-list-link">SE-0013 Remove Partial Application of Non-Final Super Methods (Swift 2.2)</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0014-constrained-AnySequence.html" class="navigation-list-link">SE-0014 Constraining `AnySequence.init`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0015-tuple-comparison-operators.html" class="navigation-list-link">SE-0015 Tuple comparison operators</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0016-initializers-for-converting-unsafe-pointers-to-ints.html" class="navigation-list-link">SE-0016 Add initializers to Int and UInt to convert from UnsafePointer and UnsafeMutablePointer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0017-convert-unmanaged-to-use-unsafepointer.html" class="navigation-list-link">SE-0017 Change `Unmanaged` to use `UnsafePointer`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0018-flexible-memberwise-initialization.html" class="navigation-list-link">SE-0018 Flexible Memberwise Initialization</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0019-package-manager-testing.html" class="navigation-list-link">SE-0019 Swift Testing</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0020-if-swift-version.html" class="navigation-list-link">SE-0020 Swift Language Version Build Configuration</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0021-generalized-naming.html" class="navigation-list-link">SE-0021 Naming Functions with Argument Labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0022-objc-selectors.html" class="navigation-list-link">SE-0022 Referencing the Objective-C selector of a method</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0023-api-guidelines.html" class="navigation-list-link">SE-0023 API Design Guidelines</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0024-optional-value-setter.html" class="navigation-list-link">SE-0024 Optional Value Setter `??=`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0025-scoped-access-level.html" class="navigation-list-link">SE-0025 Scoped Access Level</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0026-abstract-classes-and-methods.html" class="navigation-list-link">SE-0026 Abstract classes and methods</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0027-string-from-code-units.html" class="navigation-list-link">SE-0027 Expose code unit initializers on String</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0028-modernizing-debug-identifiers.html" class="navigation-list-link">SE-0028 Modernizing Swift's Debugging Identifiers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0029-remove-implicit-tuple-splat.html" class="navigation-list-link">SE-0029 Remove implicit tuple splat behavior from function applications</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0030-property-behavior-decls.html" class="navigation-list-link">SE-0030 Property Behaviors</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0031-adjusting-inout-declarations.html" class="navigation-list-link">SE-0031 Adjusting `inout` Declarations for Type Decoration</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0032-sequencetype-find.html" class="navigation-list-link">SE-0032 Add `first(where:)` method to `Sequence`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0033-import-objc-constants.html" class="navigation-list-link">SE-0033 Import Objective-C Constants as Swift Types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0034-disambiguating-line.html" class="navigation-list-link">SE-0034 Disambiguating Line Control Statements from Debugging Identifiers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0035-limit-inout-capture.html" class="navigation-list-link">SE-0035 Limiting `inout` capture to `@noescape` contexts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0036-enum-dot.html" class="navigation-list-link">SE-0036 Requiring Leading Dot Prefixes for Enum Instance Member Implementations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0037-clarify-comments-and-operators.html" class="navigation-list-link">SE-0037 Clarify interaction between comments & operators</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0038-swiftpm-c-language-targets.html" class="navigation-list-link">SE-0038 Package Manager C Language Target Support</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0039-playgroundliterals.html" class="navigation-list-link">SE-0039 Modernizing Playground Literals</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0040-attributecolons.html" class="navigation-list-link">SE-0040 Replacing Equal Signs with Colons For Attribute Arguments</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0041-conversion-protocol-conventions.html" class="navigation-list-link">SE-0041 Updating Protocol Naming Conventions for Conversions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0042-flatten-method-types.html" class="navigation-list-link">SE-0042 Flattening the function type of unapplied method references</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0043-declare-variables-in-case-labels-with-multiple-patterns.html" class="navigation-list-link">SE-0043 Declare variables in 'case' labels with multiple patterns </a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0044-import-as-member.html" class="navigation-list-link">SE-0044 Import as member</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0045-scan-takewhile-dropwhile.html" class="navigation-list-link">SE-0045 Add prefix(while:) and drop(while:) to the stdlib</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0046-first-label.html" class="navigation-list-link">SE-0046 Establish consistent label behavior across all parameters including first labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0047-nonvoid-warn.html" class="navigation-list-link">SE-0047 Defaulting non-Void functions so they warn on unused results</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0048-generic-typealias.html" class="navigation-list-link">SE-0048 Generic Type Aliases</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0049-noescape-autoclosure-type-attrs.html" class="navigation-list-link">SE-0049 Move @noescape and @autoclosure to be type attributes</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0050-floating-point-stride.html" class="navigation-list-link">SE-0050 Decoupling Floating Point Strides from Generic Implementations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0051-stride-semantics.html" class="navigation-list-link">SE-0051 Conventionalizing `stride` semantics</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0052-iterator-post-nil-guarantee.html" class="navigation-list-link">SE-0052 Change IteratorType post-nil guarantee</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0053-remove-let-from-function-parameters.html" class="navigation-list-link">SE-0053 Remove explicit use of `let` from Function Parameters</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0054-abolish-iuo.html" class="navigation-list-link">SE-0054 Abolish `ImplicitlyUnwrappedOptional` type</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0055-optional-unsafe-pointers.html" class="navigation-list-link">SE-0055 Make unsafe pointer nullability explicit using Optional</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0056-trailing-closures-in-guard.html" class="navigation-list-link">SE-0056 Allow trailing closures in `guard` conditions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0057-importing-objc-generics.html" class="navigation-list-link">SE-0057 Importing Objective-C Lightweight Generics</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0058-objectivecbridgeable.html" class="navigation-list-link">SE-0058 Allow Swift types to provide custom Objective-C representations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0059-updated-set-apis.html" class="navigation-list-link">SE-0059 Update API Naming Guidelines and Rewrite Set APIs Accordingly</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0060-defaulted-parameter-order.html" class="navigation-list-link">SE-0060 Enforcing order of defaulted parameters</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0061-autoreleasepool-signature.html" class="navigation-list-link">SE-0061 Add Generic Result and Error Handling to autoreleasepool()</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0062-objc-keypaths.html" class="navigation-list-link">SE-0062 Referencing Objective-C key-paths</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0063-swiftpm-system-module-search-paths.html" class="navigation-list-link">SE-0063 SwiftPM System Module Search Paths</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0064-property-selectors.html" class="navigation-list-link">SE-0064 Referencing the Objective-C selector of property getters and setters</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0065-collections-move-indices.html" class="navigation-list-link">SE-0065 A New Model for Collections and Indices</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0066-standardize-function-type-syntax.html" class="navigation-list-link">SE-0066 Standardize function type argument syntax to require parentheses</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0067-floating-point-protocols.html" class="navigation-list-link">SE-0067 Enhanced Floating Point Protocols</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0068-universal-self.html" class="navigation-list-link">SE-0068 Expanding Swift `Self` to class members and value types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0069-swift-mutability-for-foundation.html" class="navigation-list-link">SE-0069 Mutability and Foundation Value Types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0070-optional-requirements.html" class="navigation-list-link">SE-0070 Make Optional Requirements Objective-C-only</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0071-member-keywords.html" class="navigation-list-link">SE-0071 Allow (most) keywords in member references</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0072-eliminate-implicit-bridging-conversions.html" class="navigation-list-link">SE-0072 Fully eliminate implicit bridging conversions from Swift</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0073-noescape-once.html" class="navigation-list-link">SE-0073 Marking closures as executing exactly once</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0074-binary-search.html" class="navigation-list-link">SE-0074 Implementation of Binary Search functions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0075-import-test.html" class="navigation-list-link">SE-0075 Adding a Build Configuration Import Test</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0076-copying-to-unsafe-mutable-pointer-with-unsafe-pointer-source.html" class="navigation-list-link">SE-0076 Add overrides taking an UnsafePointer source to non-destructive copying methods on UnsafeMutablePointer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0077-operator-precedence.html" class="navigation-list-link">SE-0077 Improved operator declarations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0078-rotate-algorithm.html" class="navigation-list-link">SE-0078 Implement a rotate algorithm, equivalent to std::rotate() in C++</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0079-upgrade-self-from-weak-to-strong.html" class="navigation-list-link">SE-0079 Allow using optional binding to upgrade `self` from a weak to strong reference</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0080-failable-numeric-initializers.html" class="navigation-list-link">SE-0080 Failable Numeric Conversion Initializers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0081-move-where-expression.html" class="navigation-list-link">SE-0081 Move `where` clause to end of declaration</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0082-swiftpm-package-edit.html" class="navigation-list-link">SE-0082 Package Manager Editable Packages</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0083-remove-bridging-from-dynamic-casts.html" class="navigation-list-link">SE-0083 Remove bridging conversion behavior from dynamic casts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0084-trailing-commas.html" class="navigation-list-link">SE-0084 Allow trailing commas in parameter lists and tuples</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0085-package-manager-command-name.html" class="navigation-list-link">SE-0085 Package Manager Command Names</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0086-drop-foundation-ns.html" class="navigation-list-link">SE-0086 Drop NS Prefix in Swift Foundation</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0087-lazy-attribute.html" class="navigation-list-link">SE-0087 Rename `lazy` to `@lazy`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0088-libdispatch-for-swift3.html" class="navigation-list-link">SE-0088 Modernize libdispatch for Swift 3 naming conventions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0089-rename-string-reflection-init.html" class="navigation-list-link">SE-0089 Renaming `String.init<T>(_: T)`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0090-remove-dot-self.html" class="navigation-list-link">SE-0090 Remove `.self` and freely allow type references in expressions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0091-improving-operators-in-protocols.html" class="navigation-list-link">SE-0091 Improving operator requirements in protocols</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0092-typealiases-in-protocols.html" class="navigation-list-link">SE-0092 Typealiases in protocols and protocol extensions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0093-slice-base.html" class="navigation-list-link">SE-0093 Adding a public `base` property to slices</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0094-sequence-function.html" class="navigation-list-link">SE-0094 Add sequence(first:next:) and sequence(state:next:) to the stdlib</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0095-any-as-existential.html" class="navigation-list-link">SE-0095 Replace `protocol<P1,P2>` syntax with `P1 & P2` syntax</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0096-dynamictype.html" class="navigation-list-link">SE-0096 Converting `dynamicType` from a property to an operator</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0097-negative-attributes.html" class="navigation-list-link">SE-0097 Normalizing naming for "negative" attributes</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0098-didset-capitalization.html" class="navigation-list-link">SE-0098 Lowercase `didSet` and `willSet` for more consistent keyword casing</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0099-conditionclauses.html" class="navigation-list-link">SE-0099 Restructuring Condition Clauses</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0100-add-sequence-based-init-and-merge-to-dictionary.html" class="navigation-list-link">SE-0100 Add sequence-based initializers and merge methods to Dictionary</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0101-standardizing-sizeof-naming.html" class="navigation-list-link">SE-0101 Reconfiguring `sizeof` and related functions into a unified `MemoryLayout` struct</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0102-noreturn-bottom-type.html" class="navigation-list-link">SE-0102 Remove `@noreturn` attribute and introduce an empty `Never` type</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0103-make-noescape-default.html" class="navigation-list-link">SE-0103 Make non-escaping closures the default</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0104-improved-integers.html" class="navigation-list-link">SE-0104 Protocol-oriented integers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0105-remove-where-from-forin-loops.html" class="navigation-list-link">SE-0105 Removing Where Clauses from For-In Loops</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0106-rename-osx-to-macos.html" class="navigation-list-link">SE-0106 Add a `macOS` Alias for the `OSX` Platform Configuration Test</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0107-unsaferawpointer.html" class="navigation-list-link">SE-0107 UnsafeRawPointer API</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0108-remove-assoctype-inference.html" class="navigation-list-link">SE-0108 Remove associated type inference</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0109-remove-boolean.html" class="navigation-list-link">SE-0109 Remove the `Boolean` protocol </a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0110-distingish-single-tuple-arg.html" class="navigation-list-link">SE-0110 Distinguish between single-tuple and multiple-argument function types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0111-remove-arg-label-type-significance.html" class="navigation-list-link">SE-0111 Remove type system significance of function argument labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0112-nserror-bridging.html" class="navigation-list-link">SE-0112 Improved NSError Bridging</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0113-rounding-functions-on-floatingpoint.html" class="navigation-list-link">SE-0113 Add integral rounding functions to FloatingPoint</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0114-buffer-naming.html" class="navigation-list-link">SE-0114 Updating Buffer "Value" Names to "Header" Names</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0115-literal-syntax-protocols.html" class="navigation-list-link">SE-0115 Rename Literal Syntax Protocols</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0116-id-as-any.html" class="navigation-list-link">SE-0116 Import Objective-C `id` as Swift `Any` type</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0117-non-public-subclassable-by-default.html" class="navigation-list-link">SE-0117 Allow distinguishing between public access and public overridability</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0118-closure-parameter-names-and-labels.html" class="navigation-list-link">SE-0118 Closure Parameter Names and Labels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0119-extensions-access-modifiers.html" class="navigation-list-link">SE-0119 Remove access modifiers from extensions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0120-revise-partition-method.html" class="navigation-list-link">SE-0120 Revise `partition` Method Signature</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0121-remove-optional-comparison-operators.html" class="navigation-list-link">SE-0121 Remove `Optional` Comparison Operators</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0122-use-colons-for-subscript-type-declarations.html" class="navigation-list-link">SE-0122 Use colons for subscript declarations</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0123-disallow-value-to-optional-coercion-in-operator-arguments.html" class="navigation-list-link">SE-0123 Disallow coercion to optionals in operator arguments</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0124-bitpattern-label-for-int-initializer-objectidentfier.html" class="navigation-list-link">SE-0124 `Int.init(ObjectIdentifier)` and `UInt.init(ObjectIdentifier)` should have a `bitPattern:` label</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0125-remove-nonobjectivecbase.html" class="navigation-list-link">SE-0125 Remove `NonObjectiveCBase` and `isUniquelyReferenced`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0126-refactor-metatypes-repurpose-t-dot-self-and-mirror.html" class="navigation-list-link">SE-0126 Refactor Metatypes, repurpose `T.self` and `Mirror`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0127-cleaning-up-stdlib-ptr-buffer.html" class="navigation-list-link">SE-0127 Cleaning up stdlib Pointer and Buffer Routines</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0128-unicodescalar-failable-initializer.html" class="navigation-list-link">SE-0128 Change failable UnicodeScalar initializers to failable</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0129-package-manager-test-naming-conventions.html" class="navigation-list-link">SE-0129 Package Manager Test Naming Conventions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0130-string-initializers-cleanup.html" class="navigation-list-link">SE-0130 Replace repeating `Character` and `UnicodeScalar` forms of String.init</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0131-anyhashable.html" class="navigation-list-link">SE-0131 Add `AnyHashable` to the standard library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0132-sequence-end-ops.html" class="navigation-list-link">SE-0132 Rationalizing Sequence end-operation names</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0133-rename-flatten-to-joined.html" class="navigation-list-link">SE-0133 Rename `flatten()` to `joined()`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0134-rename-string-properties.html" class="navigation-list-link">SE-0134 Rename two UTF8-related properties on String</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0135-package-manager-support-for-differentiating-packages-by-swift-version.html" class="navigation-list-link">SE-0135 Package Manager Support for Differentiating Packages by Swift version</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0136-memory-layout-of-values.html" class="navigation-list-link">SE-0136 Memory layout of values</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0137-avoiding-lock-in.html" class="navigation-list-link">SE-0137 Avoiding Lock-In to Legacy Protocol Designs</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0138-unsaferawbufferpointer.html" class="navigation-list-link">SE-0138 UnsafeRawBufferPointer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0139-bridge-nsnumber-and-nsvalue.html" class="navigation-list-link">SE-0139 Bridge Numeric Types to `NSNumber` and Cocoa Structs to `NSValue`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0140-bridge-optional-to-nsnull.html" class="navigation-list-link">SE-0140 Warn when `Optional` converts to `Any`, and bridge `Optional` As Its Payload Or `NSNull`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0141-available-by-swift-version.html" class="navigation-list-link">SE-0141 Availability by Swift version</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0142-associated-types-constraints.html" class="navigation-list-link">SE-0142 Permit where clauses to constrain associated types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0143-conditional-conformances.html" class="navigation-list-link">SE-0143 Conditional conformances</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0144-allow-single-dollar-sign-as-valid-identifier.html" class="navigation-list-link">SE-0144 Allow Single Dollar Sign as a Valid Identifier</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0145-package-manager-version-pinning.html" class="navigation-list-link">SE-0145 Package Manager Version Pinning</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0146-package-manager-product-definitions.html" class="navigation-list-link">SE-0146 Package Manager Product Definitions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0147-move-unsafe-initialize-from.html" class="navigation-list-link">SE-0147 Move UnsafeMutablePointer.initialize(from:) to UnsafeMutableBufferPointer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0148-generic-subscripts.html" class="navigation-list-link">SE-0148 Generic Subscripts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0149-package-manager-top-of-tree.html" class="navigation-list-link">SE-0149 Package Manager Support for Top of Tree development</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0150-package-manager-branch-support.html" class="navigation-list-link">SE-0150 Package Manager Support for branches</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0151-package-manager-swift-language-compatibility-version.html" class="navigation-list-link">SE-0151 Package Manager Swift Language Compatibility Version</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0152-package-manager-tools-version.html" class="navigation-list-link">SE-0152 Package Manager Tools Version</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0153-compensate-for-the-inconsistency-of-nscopyings-behaviour.html" class="navigation-list-link">SE-0153 Compensate for the inconsistency of `@NSCopying`'s behaviour</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0154-dictionary-key-and-value-collections.html" class="navigation-list-link">SE-0154 Provide Custom Collections for Dictionary Keys and Values</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0155-normalize-enum-case-representation.html" class="navigation-list-link">SE-0155 Normalize Enum Case Representation</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0156-subclass-existentials.html" class="navigation-list-link">SE-0156 Class and Subtype existentials</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0157-recursive-protocol-constraints.html" class="navigation-list-link">SE-0157 Support recursive constraints on associated types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0158-package-manager-manifest-api-redesign.html" class="navigation-list-link">SE-0158 Package Manager Manifest API Redesign</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0159-fix-private-access-levels.html" class="navigation-list-link">SE-0159 Fix Private Access Levels</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0160-objc-inference.html" class="navigation-list-link">SE-0160 Limiting `@objc` inference</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0161-key-paths.html" class="navigation-list-link">SE-0161 Smart KeyPaths: Better Key-Value Coding for Swift</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0162-package-manager-custom-target-layouts.html" class="navigation-list-link">SE-0162 Package Manager Custom Target Layouts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0163-string-revision-1.html" class="navigation-list-link">SE-0163 String Revision: Collection Conformance, C Interop, Transcoding</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0164-remove-final-support-in-protocol-extensions.html" class="navigation-list-link">SE-0164 Remove final support in protocol extensions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0165-dict.html" class="navigation-list-link">SE-0165 Dictionary & Set Enhancements</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0166-swift-archival-serialization.html" class="navigation-list-link">SE-0166 Swift Archival & Serialization</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0167-swift-encoders.html" class="navigation-list-link">SE-0167 Swift Encoders</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0168-multi-line-string-literals.html" class="navigation-list-link">SE-0168 Multi-Line String Literals</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0169-improve-interaction-between-private-declarations-and-extensions.html" class="navigation-list-link">SE-0169 Improve Interaction Between `private` Declarations and Extensions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0170-nsnumber_bridge.html" class="navigation-list-link">SE-0170 NSNumber bridging and Numeric types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0171-reduce-with-inout.html" class="navigation-list-link">SE-0171 Reduce with `inout`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0172-one-sided-ranges.html" class="navigation-list-link">SE-0172 One-sided Ranges</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0173-swap-indices.html" class="navigation-list-link">SE-0173 Add `MutableCollection.swapAt(_:_:)`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0174-filter-range-replaceable.html" class="navigation-list-link">SE-0174 Change `filter` to return an associated type</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0175-package-manager-revised-dependency-resolution.html" class="navigation-list-link">SE-0175 Package Manager Revised Dependency Resolution</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0176-enforce-exclusive-access-to-memory.html" class="navigation-list-link">SE-0176 Enforce Exclusive Access to Memory</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0177-add-clamped-to-method.html" class="navigation-list-link">SE-0177 Add clamp(to:) to the stdlib</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0178-character-unicode-view.html" class="navigation-list-link">SE-0178 Add `unicodeScalars` property to `Character`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0179-swift-run-command.html" class="navigation-list-link">SE-0179 Swift `run` Command</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0180-string-index-overhaul.html" class="navigation-list-link">SE-0180 String Index Overhaul</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0181-package-manager-cpp-language-version.html" class="navigation-list-link">SE-0181 Package Manager C/C++ Language Standard Support</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0182-newline-escape-in-strings.html" class="navigation-list-link">SE-0182 String Newline Escaping</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0183-substring-affordances.html" class="navigation-list-link">SE-0183 Substring performance affordances</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0184-unsafe-pointers-add-missing.html" class="navigation-list-link">SE-0184 Unsafe[Mutable][Raw][Buffer]Pointer: add missing methods, adjust existing labels for clarity, and remove deallocation size</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0185-synthesize-equatable-hashable.html" class="navigation-list-link">SE-0185 Synthesizing `Equatable` and `Hashable` conformance</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0186-remove-ownership-keyword-support-in-protocols.html" class="navigation-list-link">SE-0186 Remove ownership keyword support in protocols</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0187-introduce-filtermap.html" class="navigation-list-link">SE-0187 Introduce Sequence.compactMap(_:)</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0188-stdlib-index-types-hashable.html" class="navigation-list-link">SE-0188 Make Standard Library Index Types Hashable</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0189-restrict-cross-module-struct-initializers.html" class="navigation-list-link">SE-0189 Restrict Cross-module Struct Initializers</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0190-target-environment-platform-condition.html" class="navigation-list-link">SE-0190 Target environment platform condition</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0191-eliminate-indexdistance.html" class="navigation-list-link">SE-0191 Eliminate `IndexDistance` from `Collection`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0192-non-exhaustive-enums.html" class="navigation-list-link">SE-0192 Handling Future Enum Cases</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0193-cross-module-inlining-and-specialization.html" class="navigation-list-link">SE-0193 Cross-module inlining and specialization</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0194-derived-collection-of-enum-cases.html" class="navigation-list-link">SE-0194 Derived Collection of Enum Cases</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0195-dynamic-member-lookup.html" class="navigation-list-link">SE-0195 Introduce User-defined "Dynamic Member Lookup" Types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0196-diagnostic-directives.html" class="navigation-list-link">SE-0196 Compiler Diagnostic Directives</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0197-remove-where.html" class="navigation-list-link">SE-0197 Adding in-place `removeAll(where:)` to the Standard Library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0198-playground-quicklook-api-revamp.html" class="navigation-list-link">SE-0198 Playground QuickLook API Revamp #</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0199-bool-toggle.html" class="navigation-list-link">SE-0199 Adding `toggle` to `Bool`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0200-raw-string-escaping.html" class="navigation-list-link">SE-0200 Enhancing String Literals Delimiters to Support Raw Text</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0201-package-manager-local-dependencies.html" class="navigation-list-link">SE-0201 Package Manager Local Dependencies</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0202-random-unification.html" class="navigation-list-link">SE-0202 Random Unification</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0203-rename-sequence-elements-equal.html" class="navigation-list-link">SE-0203 Rename Sequence.elementsEqual</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0204-add-last-methods.html" class="navigation-list-link">SE-0204 Add `last(where:)` and `lastIndex(where:)` Methods</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0205-withUnsafePointer-for-lets.html" class="navigation-list-link">SE-0205 `withUnsafePointer(to:_:)` and `withUnsafeBytes(of:_:)` for immutable values</a></li><li class="navigation-list-item active"><a href="http://localhost:4000/docs/2019-08-26-0206-hashable-enhancements.html" class="navigation-list-link active">SE-0206 Hashable Enhancements</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0207-containsOnly.html" class="navigation-list-link">SE-0207 Add an `allSatisfy` algorithm to `Sequence`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0208-package-manager-system-library-targets.html" class="navigation-list-link">SE-0208 Package Manager System Library Targets</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0209-package-manager-swift-lang-version-update.html" class="navigation-list-link">SE-0209 Package Manager Swift Language Version API Update</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0210-key-path-offset.html" class="navigation-list-link">SE-0210 Add an `offset(of:)` method to `MemoryLayout`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0211-unicode-scalar-properties.html" class="navigation-list-link">SE-0211 Add Unicode Properties to `Unicode.Scalar`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0212-compiler-version-directive.html" class="navigation-list-link">SE-0212 Compiler Version Directive</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0213-literal-init-via-coercion.html" class="navigation-list-link">SE-0213 Literal initialization via coercion</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0214-DictionaryLiteral.html" class="navigation-list-link">SE-0214 Renaming the `DictionaryLiteral` type to `KeyValuePairs`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0215-conform-never-to-hashable-and-equatable.html" class="navigation-list-link">SE-0215 Conform `Never` to `Equatable` and `Hashable`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0216-dynamic-callable.html" class="navigation-list-link">SE-0216 Introduce user-defined dynamically "callable" types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0217-bangbang.html" class="navigation-list-link">SE-0217 Introducing the `!!` "Unwrap or Die" operator to the Swift Standard Library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0218-introduce-compact-map-values.html" class="navigation-list-link">SE-0218 Introduce `compactMapValues` to Dictionary</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0219-package-manager-dependency-mirroring.html" class="navigation-list-link">SE-0219 Package Manager Dependency Mirroring</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0220-count-where.html" class="navigation-list-link">SE-0220 `count(where:)`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0221-character-properties.html" class="navigation-list-link">SE-0221 Character Properties</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0222-lazy-compactmap-sequence.html" class="navigation-list-link">SE-0222 Lazy CompactMap Sequence</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0223-array-uninitialized-initializer.html" class="navigation-list-link">SE-0223 Accessing an Array's Uninitialized Buffer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0224-ifswift-lessthan-operator.html" class="navigation-list-link">SE-0224 Support 'less than' operator in compilation conditions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0225-binaryinteger-iseven-isodd-ismultiple.html" class="navigation-list-link">SE-0225 Adding `isMultiple` to `BinaryInteger`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0226-package-manager-target-based-dep-resolution.html" class="navigation-list-link">SE-0226 Package Manager Target Based Dependency Resolution</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0227-identity-keypath.html" class="navigation-list-link">SE-0227 Identity key path</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0228-fix-expressiblebystringinterpolation.html" class="navigation-list-link">SE-0228 Fix `ExpressibleByStringInterpolation`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0229-simd.html" class="navigation-list-link">SE-0229 SIMD Vectors</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0230-flatten-optional-try.html" class="navigation-list-link">SE-0230 Flatten nested optionals resulting from 'try?'</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0231-optional-iteration.html" class="navigation-list-link">SE-0231 Optional Iteration</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0232-remove-customization-points.html" class="navigation-list-link">SE-0232 Remove Some Customization Points from the Standard Library's `Collection` Hierarchy</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0233-additive-arithmetic-protocol.html" class="navigation-list-link">SE-0233 Make `Numeric` Refine a new `AdditiveArithmetic` Protocol</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0234-remove-sequence-subsequence.html" class="navigation-list-link">SE-0234 Remove `Sequence.SubSequence`</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0235-add-result.html" class="navigation-list-link">SE-0235 Add Result to the Standard Library</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0236-package-manager-platform-deployment-settings.html" class="navigation-list-link">SE-0236 Package Manager Platform Deployment Settings</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0237-contiguous-collection.html" class="navigation-list-link">SE-0237 Introduce `withContiguous{Mutable}StorageIfAvailable` methods</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0238-package-manager-build-settings.html" class="navigation-list-link">SE-0238 Package Manager Target Specific Build Settings</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0239-codable-range.html" class="navigation-list-link">SE-0239 Add Codable conformance to Range types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0240-ordered-collection-diffing.html" class="navigation-list-link">SE-0240 Ordered Collection Diffing</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0241-string-index-explicit-encoding-offset.html" class="navigation-list-link">SE-0241 Deprecate String Index Encoded Offsets</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0242-default-values-memberwise.html" class="navigation-list-link">SE-0242 Synthesize default values for the memberwise initializer</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0243-codepoint-and-character-literals.html" class="navigation-list-link">SE-0243 Integer-convertible character literals</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0244-opaque-result-types.html" class="navigation-list-link">SE-0244 Opaque Result Types</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0245-array-uninitialized-initializer.html" class="navigation-list-link">SE-0245 Add an Array Initializer with Access to Uninitialized Storage</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0246-mathable.html" class="navigation-list-link">SE-0246 Generic Math(s) Functions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0247-contiguous-strings.html" class="navigation-list-link">SE-0247 Contiguous Strings</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0248-string-gaps-missing-apis.html" class="navigation-list-link">SE-0248 String Gaps and Missing APIs</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0249-key-path-literal-function-expressions.html" class="navigation-list-link">SE-0249 Key Path Expressions as Functions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0250-swift-style-guide-and-formatter.html" class="navigation-list-link">SE-0250 Swift Code Style Guidelines and Formatter</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0251-simd-additions.html" class="navigation-list-link">SE-0251 SIMD additions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0252-keypath-dynamic-member-lookup.html" class="navigation-list-link">SE-0252 Key Path Member Lookup</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0253-callable.html" class="navigation-list-link">SE-0253 Introduce callables </a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0254-static-subscripts.html" class="navigation-list-link">SE-0254 Static and class subscripts</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0255-omit-return.html" class="navigation-list-link">SE-0255 Implicit returns from single-expression functions</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0256-contiguous-collection.html" class="navigation-list-link">SE-0256 Introduce `{Mutable}ContiguousCollection` protocol</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-0257-elide-comma.html" class="navigation-list-link">SE-0257 Eliding commas from multiline expression lists</a></li><li class="navigation-list-item"><a href="http://localhost:4000/docs/2019-08-26-xxxx-synthesize-computed-property.html" class="navigation-list-link"> Feature name</a></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Swift Evolution List" aria-label="Search Swift Evolution List" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="//github.com/pondok-programmer/swift-evolution-jekyll">Swift Evolution List</a></li> </ul> </div> <div class="page"> <div id="main-content" class="page-content" role="main"> <h1 id="hashable-enhancements"> <a href="#hashable-enhancements" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Hashable Enhancements </h1> <ul> <li>Proposal: <a href="0206-hashable-enhancements.md">SE-0206</a></li> <li>Authors: <a href="https://github.com/lorentey">Karoy Lorentey</a>, <a href="https://github.com/regexident">Vincent Esche</a></li> <li>Review Manager: <a href="https://github.com/jckarter">Joe Groff</a></li> <li>Status: <strong>Implemented (Swift 4.2)</strong></li> <li>Decision Notes: <a href="https://forums.swift.org/t/accepted-se-0206-hashable-enhancements/11675/115">Rationale</a></li> <li>Implementation:<br /> <a href="https://github.com/apple/swift/pull/14913">apple/swift#14913</a> (standard library, underscored),<br /> <a href="https://github.com/apple/swift/pull/16009">apple/swift#16009</a> (<code class="highlighter-rouge">Hasher</code> interface),<br /> <a href="https://github.com/apple/swift/pull/16073">apple/swift#16073</a> (automatic synthesis, de-underscoring)<br /></li> <li>Previous Revision: <a href="https://github.com/apple/swift-evolution/blob/f5a020ec79cdb64fc8700af91b1a1ece2d2fb141/proposals/0206-hashable-enhancements.md">1</a></li> </ul> <!-- *During the review process, add the following fields as needed:* * Decision Notes: [Rationale](https://forums.swift.org/), [Additional Commentary](https://forums.swift.org/) * Bugs: [SR-NNNN](https://bugs.swift.org/browse/SR-NNNN), [SR-MMMM](https://bugs.swift.org/browse/SR-MMMM) * Previous Proposal: [SE-XXXX](XXXX-filename.md) --> <h2 id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Table of contents </h2> <ul> <li><a href="#intro">Introduction</a></li> <li><a href="#why">Motivation</a> <ul> <li><a href="#status-quo">The status quo</a></li> <li><a href="#universal-hashing">Universal hash functions</a></li> </ul> </li> <li><a href="#proposed-solution">Proposed solution</a> <ul> <li><a href="#hasher">The <code class="highlighter-rouge">Hasher</code> struct</a></li> <li><a href="#hash-into">The <code class="highlighter-rouge">hash(into:)</code> requirement</a></li> </ul> </li> <li><a href="#detailed-design">Detailed design</a> <ul> <li><a href="#hasher-details"><code class="highlighter-rouge">Hasher</code></a></li> <li><a href="#hashable-details"><code class="highlighter-rouge">Hashable</code></a></li> </ul> </li> <li><a href="#source-compatibility">Source compatibility</a></li> <li><a href="#abi">Effect on ABI stability</a></li> <li><a href="#resilience">Effect on API resilience</a></li> <li><a href="#alternatives">Alternatives considered</a> <ul> <li><a href="#leave-hashable-alone">Leaving <code class="highlighter-rouge">Hashable</code> as is</a></li> <li><a href="#new-protocol">Defining a new protocol</a></li> <li><a href="#generic-hasher">Making <code class="highlighter-rouge">hash(into:)</code> generic over a <code class="highlighter-rouge">Hasher</code> protocol</a></li> <li><a href="#closure-hasher">Change <code class="highlighter-rouge">hash(into:)</code> to take a closure instead of a new type</a></li> </ul> </li> </ul> <h2 id="introduction"> <a href="#introduction" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="intro">Introduction</a> </h2> <p>This proposal introduces a new <code class="highlighter-rouge">Hasher</code> type representing the standard library’s universal hash function, and it extends the <code class="highlighter-rouge">Hashable</code> protocol with a new <code class="highlighter-rouge">hash(into:)</code> requirement that expresses hashing in terms of <code class="highlighter-rouge">Hasher</code>. This new requirement is intended to replace the old <code class="highlighter-rouge">hashValue</code> property, which is deprecated.</p> <p>Switching to <code class="highlighter-rouge">hash(into:)</code> moves the choice of a hash function out of <code class="highlighter-rouge">Hashable</code> implementations, and into the standard library. This makes it considerably easier to manually conform types to <code class="highlighter-rouge">Hashable</code> – the task of writing a custom implementation reduces to identifying the parts of a type that should contribute to the hash value.</p> <p>Standardizing on a single, high-quality hash function greatly improves the reliability of <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code>. The hash function can be specially selected and tuned to work well with the hash tables used by these collections, preventing hash collision patterns that would break the expected performance of common operations.</p> <p><code class="highlighter-rouge">Hasher</code> is a resilient struct, enabling future versions of the standard library to improve the hash function without the need to change (or even recompile) existing code that implements <code class="highlighter-rouge">Hashable</code>. Not baking any particular hash function into <code class="highlighter-rouge">Hashable</code> types is especially important in case a weakness is found in the current algorithm.</p> <p>Swift-evolution thread: <a href="https://forums.swift.org/t/combining-hashes/9082">Combining Hashes</a></p> <h2 id="motivation"> <a href="#motivation" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="why">Motivation</a> </h2> <p>The Swift Standard Library includes two general-purpose hashing collections, <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code>. These collections are built around hash tables, whose performance is critically dependent on the expected distribution of the elements stored in them, along with the quality of the hash function that is used to derive bucket indices for individual elements.</p> <p>With a good hash function, simple lookups, insertions and removals take constant time on average. However, when the hash function isn’t carefully chosen to suit the data, the expected time of such operations can become proportional to the number of elements stored in the table. If the table is large enough, such a regression can easily lead to unacceptable performance. When they’re overwhelmed with hash collisions, applications and network services may stop processing new events for prolonged periods of time; this can easily be enough to make the app unresponsive or to bring down the service.</p> <h3 id="the-status-quo"> <a href="#the-status-quo" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="status-quo">The status quo</a> </h3> <p>Since Swift version 1.0, <code class="highlighter-rouge">Hashable</code> has had a single requirement on top of <code class="highlighter-rouge">Equatable</code>: the <code class="highlighter-rouge">hashValue</code> property. <code class="highlighter-rouge">hashValue</code> looks deceptively simple, but implementing it is unreasonably hard: Not only do we need to decide which components of our type should be involved in hashing, but we also have to come up with a way to somehow distill these components down into a single integer value. The API is essentially asking us to implement a new hash function, from scratch, every single time we conform to <code class="highlighter-rouge">Hashable</code>.</p> <p>Given adequate documentation, it is reasonable to expect that an experienced programmer implementing a custom type would be able to identify what parts need to be hashed. On the other hand, implementing a good hash function requires careful consideration and specialist knowledge. It is unreasonable to expect Swift programmers to invest time and effort to get this right for every <code class="highlighter-rouge">Hashable</code> type out there.</p> <p>For example, consider the code below, extracted directly from the documentation of Swift 4.1’s <code class="highlighter-rouge">Hashable</code>. Is this a good implementation of <code class="highlighter-rouge">hashValue</code>?</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">GridPoint</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">Int</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">GridPoint</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">hashValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">hashValue</span> <span class="o">^</span> <span class="n">y</span><span class="o">.</span><span class="n">hashValue</span> <span class="o">&amp;*</span> <span class="mi">16777619</span>
  <span class="p">}</span>

  <span class="kd">static</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">GridPoint</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">GridPoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">lhs</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">y</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>The answer is that it depends; while the hash values it produces are perfectly fine if <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> are expected to be small integers coming from trusted sources, this hash function does have some undesirable properties:</p> <ol> <li> <p>The clever bit manipulations make it hard to understand what the code does, or how it works. For example, can you tell what makes 16777619 a better choice for the multiplier than, say, 16777618? What are the precedence rules for <code class="highlighter-rouge">^</code> and <code class="highlighter-rouge">&amp;*</code> again? What’s with the ampersand, anyway?</p> <p>We just wanted to use <code class="highlighter-rouge">GridPoint</code> values as keys in a <code class="highlighter-rouge">Dictionary</code>, but first, we need to spend a couple of hours learning about bitwise operations, integer overflows and the exciting properties of coprime numbers.</p> <p>(For what it’s worth, the magic constant used in the example above is the same as the one used for the 32-bit version of the <a href="http://www.isthe.com/chongo/tech/comp/fnv/index.html">FNV-1a</a> hashing algorithm, which uses a similar (if a little more complicated) method to distill arbitrary byte sequences down into a single integer.)</p> </li> <li> <p>It is trivially easy to construct an arbitrarily large set of <code class="highlighter-rouge">GridPoint</code> values that aren’t equal, but have the same hash value. If the values come from an untrusted source, they may sometimes be deliberately chosen to induce collisions.</p> </li> <li> <p>The hash function doesn’t do a particularly great job at mixing up the input data; the hash values it produces tend to form long chains of sequential integer clusters. While these aren’t as bad as hash collisions, some hash table operations can slow down drasticaly when such clusters are present. (In Swift 4.1, <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code> use open addressing with linear probing, and they have to do some clever postprocessing of hash values to get rid of such patterns.)</p> </li> </ol> <p>It seems desirable for the standard library to provide better guidance for people implementing <code class="highlighter-rouge">hashValue</code>.</p> <h3 id="universal-hash-functions"> <a href="#universal-hash-functions" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="universal-hashing">Universal hash functions</a> </h3> <p>With <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md">SE-0185</a>, Swift 4.1 introduced compiler support for automatic synthesis of <code class="highlighter-rouge">Hashable</code> conformance for certain types. For example, the <code class="highlighter-rouge">GridPoint</code> struct above can be made to conform to <code class="highlighter-rouge">Hashable</code> without explicitly defining <code class="highlighter-rouge">hashValue</code> (or <code class="highlighter-rouge">==</code>):</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">GridPoint</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">Int</span>
  
  <span class="c1">// hashValue and == are automatically synthesized by the compiler</span>
<span class="p">}</span>
</code></pre></div></div> <p><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md">SE-0185</a> did not specify a hash function to be used for such conformances, leaving it as an implementation detail of the compiler and the standard library. Doing this well requires the use of a hash function that works equally well on any number of components, regardless of their expected distributions.</p> <p>Luckily, this problem has occured in other contexts before, and there is an extensive list of hash functions that have been designed for exactly such cases: <a href="http://www.isthe.com/chongo/tech/comp/fnv/index.html">Foller-Noll-Vo</a>, <a href="https://github.com/aappleby/smhasher">MurmurHash</a>, <a href="https://github.com/google/cityhash">CityHash</a>, <a href="https://131002.net/siphash/">SipHash</a>, and <a href="https://github.com/google/highwayhash">HighwayHash</a> are just a small selection of these. The last two algorithms include some light cryptographic elements so that they provide a level of protection against deliberate hash collision attacks. This makes them a better choice for general-purpose hashed collections like <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code>.</p> <p>Since <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md">SE-0185</a> required the standard library to implement a high-quality universal hash function, it seems like a good idea to expose it as public API, so that manual <code class="highlighter-rouge">Hashable</code> implementations can take advantage of it, too.</p> <p>Universal hash functions work by maintaining some internal state – this can be as simple as a single 32/64-bit integer value (for e.g. <a href="http://www.isthe.com/chongo/tech/comp/fnv/index.html">FNV-1a</a>), but it is usually much wider than that. For example, <a href="https://131002.net/siphash/">SipHash</a> maintains a state of 256 bits, while <a href="https://github.com/google/highwayhash">HighwayHash</a> uses 1024 bits.</p> <h2 id="proposed-solution"> <a href="#proposed-solution" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="proposed-solution">Proposed solution</a> </h2> <p>We solve <code class="highlighter-rouge">Hashable</code>’s implementation problems in two parts. First, we make the standard library’s hash function public. Second, we replace <code class="highlighter-rouge">hashValue</code> with a requirement that is designed specifically to eliminate the guesswork from manual <code class="highlighter-rouge">Hashable</code> implementations.</p> <h3 id="the-hasher-struct"> <a href="#the-hasher-struct" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="hasher">The <code class="highlighter-rouge">Hasher</code> struct</a> </h3> <p>We propose to expose the standard library’s standard hash function as a new, public struct type, called <code class="highlighter-rouge">Hasher</code>. This new struct captures the state of the hash function, and provides the following operations:</p> <ol> <li> <p>An initializer to create an empty state. To make hash values less predictable, the standard hash function uses a per-execution random seed, so that generated hash values will be different in each execution of a Swift program.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Hasher</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span>  <span class="c1">// Uses a per-execution random seed value</span>
 <span class="p">}</span>
</code></pre></div> </div> </li> <li> <p>Operations to feed new bytes to the hash function, mixing them into its state:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">extension</span> <span class="kt">Hasher</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">combine</span><span class="p">(</span><span class="n">bytes</span> <span class="nv">buffer</span><span class="p">:</span> <span class="kt">UnsafeRawBufferPointer</span><span class="p">)</span>
   <span class="kd">public</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="n">combine</span><span class="o">&lt;</span><span class="kt">H</span><span class="p">:</span> <span class="kt">Hashable</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">H</span><span class="p">)</span>
 <span class="p">}</span>
</code></pre></div> </div> <p><code class="highlighter-rouge">combine(bytes:)</code> is the most general operation, suitable for use when the bytes to be hashed are available as a single contiguous region in memory.</p> <p><code class="highlighter-rouge">combine(_:)</code> is a convenience operation that can take any <code class="highlighter-rouge">Hashable</code> value; we expect this will be more frequently useful. (We’ll see how this is implemented in the next section.)</p> </li> <li> <p>An operation to finalize the state, extracting the hash value from it.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">extension</span> <span class="kt">Hasher</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="n">__consuming</span> <span class="kd">func</span> <span class="nf">finalize</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
 <span class="p">}</span>
</code></pre></div> </div> <p>Finalizing the hasher state consumes it; it is illegal to call <code class="highlighter-rouge">combine</code> or <code class="highlighter-rouge">finalize</code> on a hasher you don’t own, or on one that’s already been finalized.</p> </li> </ol> <p>For example, here is how one may use <code class="highlighter-rouge">Hasher</code> as a standalone type:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">hasher</span> <span class="o">=</span> <span class="kt">Hasher</span><span class="p">()</span>        <span class="c1">// Initialize state, usually by random seeding</span>
<span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>           <span class="c1">// Mix in several integer's worth of bytes</span>
<span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">hasher</span><span class="o">.</span><span class="nf">finalize</span><span class="p">())</span>     <span class="c1">// Finalize the state and return the hash</span>
</code></pre></div></div> <p>Within the same execution of a Swift program, <code class="highlighter-rouge">Hasher</code>s are guaranteed to return the same hash value in <code class="highlighter-rouge">finalize()</code>, as long as they are fed the exact same sequence of bytes. (Note that the order of <code class="highlighter-rouge">combine</code> operations matters; swapping the two integers above will produce a completely different hash.)</p> <p>However, <code class="highlighter-rouge">Hasher</code> may generate entirely different hash values in other executions, <em>even if it is fed the exact same byte sequence</em>. This randomization is a critical feature, as it makes it much harder for potential attackers to predict hash values. <code class="highlighter-rouge">Hashable</code> has always been documented to explicitly allow such nondeterminism:</p> <blockquote> <ul> <li>Important: Hash values are not guaranteed to be equal across different executions of your program. Do not save hash values to use in a future execution.</li> </ul> <p><cite>– <code class="highlighter-rouge">Hashable</code> documentation</cite></p> </blockquote> <p>(Random seeding can be disabled by setting a special environment variable; see <a href="#abi">Effect on ABI stability</a> for details.)</p> <p>The choice of which hash function <code class="highlighter-rouge">Hasher</code> implements is an implementation detail of the standard library, and may change in any new release. This includes the size and internal layout of <code class="highlighter-rouge">Hasher</code> itself. (The current implementation uses SipHash-1-3 with 320 bits of state.)</p> <h3 id="the-hashinto-requirement"> <a href="#the-hashinto-requirement" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="hash-into">The <code class="highlighter-rouge">hash(into:)</code> requirement</a> </h3> <p>Introducing <code class="highlighter-rouge">Hasher</code> is a big improvement, but it’s only half of the story: <code class="highlighter-rouge">Hashable</code> itself needs to be updated to make better use of it.</p> <p>We propose to change the <code class="highlighter-rouge">Hashable</code> protocol by adding a new <code class="highlighter-rouge">hash(into:)</code> requirement:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">Hashable</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">hashValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
  <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">Hasher</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>At the same time, we deprecate custom implementations of the <code class="highlighter-rouge">hashValue</code> property. (Please see the section on <a href="#source-compatibility">Source compatibility</a> on how we’ll do this without breaking code written for previous versions of Swift.) In some future language version, we intend to convert <code class="highlighter-rouge">hashValue</code> to an extension method.</p> <p>To make it easier to express <code class="highlighter-rouge">hash(into:)</code> in terms of <code class="highlighter-rouge">Hashable</code> components, <code class="highlighter-rouge">Hasher</code> provides a variant of <code class="highlighter-rouge">combine</code> that simply calls <code class="highlighter-rouge">hash(into:)</code> on the supplied value:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">Hasher</span> <span class="p">{</span>
  <span class="kd">@inlinable</span>
  <span class="kd">public</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="n">combine</span><span class="o">&lt;</span><span class="kt">H</span><span class="p">:</span> <span class="kt">Hashable</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">H</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span><span class="o">.</span><span class="nf">hash</span><span class="p">(</span><span class="nv">into</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">self</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>This is purely for convenience; <code class="highlighter-rouge">hasher.combine(foo)</code> is slightly easier to type than <code class="highlighter-rouge">foo.hash(into: &amp;hasher)</code>.</p> <p>At first glance, it may not be obvious why we need to replace <code class="highlighter-rouge">hashValue</code>. After all, <code class="highlighter-rouge">Hasher</code> can be used to take the guesswork out of its implementation:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">GridPoint</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">hashValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> 
    <span class="k">var</span> <span class="nv">hasher</span> <span class="o">=</span> <span class="kt">Hasher</span><span class="p">()</span>
    <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="nf">finalize</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>What’s wrong with this? What makes <code class="highlighter-rouge">hash(into:)</code> so much better that’s worth the cost of a change to a basic protocol?</p> <ul> <li> <p><strong>Better Discoverability</strong> – With <code class="highlighter-rouge">hashValue</code>, you need to know about <code class="highlighter-rouge">Hasher</code> to make use of it: the API does not direct you to do the right thing. Worse, you have to do extra busywork by manually initializing and finalizing a <code class="highlighter-rouge">Hasher</code> instance directly in your <code class="highlighter-rouge">hashValue</code> implementation. Compare the code above to the <code class="highlighter-rouge">hash(into:)</code> implementation below:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">GridPoint</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">Hasher</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> <p>This is nice and easy, with minimal boilerplate. <code class="highlighter-rouge">Hasher</code> is part of the function signature; people who need to implement <code class="highlighter-rouge">hash(into:)</code> are naturally guided to learn about it.</p> </li> <li> <p><strong>Guaranteed Dispersion Quality</strong> – Keeping the existing <code class="highlighter-rouge">hashValue</code> interface would mean that there was no way for <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code> to guarantee that <code class="highlighter-rouge">Hashable</code> types produce hash values with good enough dispersion. Therefore, these collections would need to keep postprocessing hash values. We’d like to eliminate postprocessing overhead for types that upgrade to <code class="highlighter-rouge">Hasher</code>.</p> </li> <li> <p><strong>Hasher Customizability</strong> – <code class="highlighter-rouge">hash(into:)</code> moves the initialization of <code class="highlighter-rouge">Hasher</code> out of <code class="highlighter-rouge">Hashable</code> types, and into hashing collections. This allows us to customize <code class="highlighter-rouge">Hasher</code> to the needs of each hashing data structure. For example, the stdlib could start using a different seed value for every new <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code> instance; this somewhat improves reliability by making hash values even less predictable, but (probably more importantly), it drastically improves the performance of some relatively common operations involving <a href="https://bugs.swift.org/browse/SR-3268">copying data between <code class="highlighter-rouge">Set</code>/<code class="highlighter-rouge">Dictionary</code> instances</a>.</p> </li> <li> <p><strong>Better Performance</strong> – Similarly, <code class="highlighter-rouge">hash(into:)</code> moves the finalization step out of <code class="highlighter-rouge">Hashable</code>. Finalization is a relatively expensive operation; for example, in SipHash-1-3, it costs three times as much as a single 64-bit <code class="highlighter-rouge">combine</code>. Repeating it for every single component of a composite type would make hashing unreasonably slow.</p> <p>For example, consider the <code class="highlighter-rouge">GridRectangle</code> type below:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">GridRectangle</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">topLeft</span><span class="p">:</span> <span class="kt">GridPoint</span>
  <span class="k">let</span> <span class="nv">bottomRight</span><span class="p">:</span> <span class="kt">GridPoint</span>
<span class="p">}</span>
</code></pre></div> </div> <p>With <code class="highlighter-rouge">hashValue</code>, its <code class="highlighter-rouge">Hashable</code> implementation would look like this:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">GridRectangle</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">hashValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="c1">// SLOW, DO NOT USE</span>
    <span class="k">var</span> <span class="nv">hasher</span> <span class="o">=</span> <span class="kt">Hasher</span><span class="p">()</span>
    <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="nv">bits</span><span class="p">:</span> <span class="n">topLeft</span><span class="o">.</span><span class="n">hashValue</span><span class="p">)</span> 
    <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="nv">bits</span><span class="p">:</span> <span class="n">bottomRight</span><span class="o">.</span><span class="n">hashValue</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="nf">finalize</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> <p>Both of the <code class="highlighter-rouge">hashValue</code> invocations above create and finalize separate hashers. Assuming finalization takes three times as much time as a single combine call (and generously assuming that initialization is free) this takes 15 combines’ worth of time:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 1   hasher.combine(topLeft.hashValue)
 1       hasher.combine(topLeft.x)     (in topLeft.hashValue)
 1       hasher.combine(topLeft.y)
 3       hasher.finalize()
 1   hasher.combine(bottomRight.hashValue)
 1       hasher.combine(bottomRight.x) (in bottomRight.hashValue)
 1       hasher.combine(bottomRight.y)
 3       hasher.finalize()
 3   hasher.finalize()
---
15
</code></pre></div> </div> <p>Switching to <code class="highlighter-rouge">hash(into:)</code> gets us the following code:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">GridRegion</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">Hasher</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="n">topLeft</span><span class="p">)</span>
    <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="n">bottomRight</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> <p>This reduces the cost of hashing to just four combines and a single finalization, which takes less than half the time of our original approach:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 1   hasher.combine(topLeft.x)      (in topLeft.hash(into:))
 1   hasher.combine(topLeft.y)
 1   hasher.combine(bottomRight.x)  (in bottomRight.hash(into:))
 1   hasher.combine(bottomRight.y)
 3   hasher.finalize()             (outside of GridRectangle.hash(into:))
---
 7
</code></pre></div> </div> </li> </ul> <p>Switching to <code class="highlighter-rouge">hash(into:)</code> gets us more robust hash values faster, and with cleaner, simpler code.</p> <h2 id="detailed-design"> <a href="#detailed-design" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="detailed-design">Detailed design</a> </h2> <h3 id="hasher"> <a href="#hasher" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="hasher-details"><code class="highlighter-rouge">Hasher</code></a> </h3> <p>Add the following type to the standard library:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Represents the universal hash function used by `Set` and `Dictionary`.</span>
<span class="c1">///</span>
<span class="c1">/// The hash function is a mapping from a 128-bit seed value and an </span>
<span class="c1">/// arbitrary sequence of bytes to an integer hash value. The seed value</span>
<span class="c1">/// is specified during `Hasher` initialization, while the byte sequence</span>
<span class="c1">/// is fed to the hasher using a series of calls to mutating `combine`</span>
<span class="c1">/// methods. When all bytes have been fed to the hasher, the hash value </span>
<span class="c1">/// can be retrieved by calling `finalize()`:</span>
<span class="c1">///</span>
<span class="c1">///     var hasher = Hasher()</span>
<span class="c1">///     hasher.combine(23)</span>
<span class="c1">///     hasher.combine("Hello")</span>
<span class="c1">///     let hashValue = hasher.finalize()</span>
<span class="c1">///</span>
<span class="c1">/// The underlying hash algorithm is designed to exhibit avalanche</span>
<span class="c1">/// effects: slight changes to the seed or the input byte sequence</span>
<span class="c1">/// will produce drastic changes in the generated hash value.</span>
<span class="c1">///</span>
<span class="c1">/// - Note: `Hasher` is usually randomly seeded, which means it will return</span>
<span class="c1">///   different values on every new execution of your program. The hash </span>
<span class="c1">///   algorithm implemented by `Hasher` may itself change between </span>
<span class="c1">///   any two versions of the standard library. Do not save or otherwise </span>
<span class="c1">///   reuse hash values across executions of your program.</span>
<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Hasher</span> <span class="p">{</span>
  <span class="c1">/// Initialize a new hasher using a per-execution seed value.</span>
  <span class="c1">/// The seed is set during process startup, usually from a high-quality </span>
  <span class="c1">/// random source.</span>
  <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span>
  
  <span class="c1">/// Feed `value` to this hasher, mixing its essential parts into</span>
  <span class="c1">/// the hasher state.</span>
  <span class="kd">@inlinable</span>
  <span class="kd">public</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="n">combine</span><span class="o">&lt;</span><span class="kt">H</span><span class="p">:</span> <span class="kt">Hashable</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">H</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span><span class="o">.</span><span class="nf">hash</span><span class="p">(</span><span class="nv">into</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">self</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">/// Feed the raw bytes in `buffer` into this hasher, mixing its bits into</span>
  <span class="c1">/// the hasher state.</span>
  <span class="kd">public</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">combine</span><span class="p">(</span><span class="n">bytes</span> <span class="nv">buffer</span><span class="p">:</span> <span class="kt">UnsafeRawBufferPointer</span><span class="p">)</span>
  
  <span class="c1">/// Finalize the hasher state and return the hash value.</span>
  <span class="c1">///</span>
  <span class="c1">/// Finalizing consumes the hasher: it is illegal to finalize a hasher you</span>
  <span class="c1">/// don't own, or to perform operations on a finalized hasher. (These may</span>
  <span class="c1">/// become compile-time errors in the future.)</span>
  <span class="kd">public</span> <span class="n">__consuming</span> <span class="kd">func</span> <span class="nf">finalize</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="hashable"> <a href="#hashable" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="hashable-details"><code class="highlighter-rouge">Hashable</code></a> </h2> <p>Change the <code class="highlighter-rouge">Hashable</code> protocol as follows.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// A type that can be hashed into a `Hasher`.</span>
<span class="c1">///</span>
<span class="c1">/// You can use any type that conforms to the `Hashable` protocol in a set or as</span>
<span class="c1">/// a dictionary key. Many types in the standard library conform to `Hashable`:</span>
<span class="c1">/// Strings, integers, floating-point and Boolean values, and even sets are</span>
<span class="c1">/// hashable by default. Some other types, such as optionals, arrays and ranges</span>
<span class="c1">/// automatically become hashable when their type arguments implement the same.</span>
<span class="c1">///</span>
<span class="c1">/// Your own custom types can be hashable as well. When you define an</span>
<span class="c1">/// enumeration without associated values, it gains `Hashable` conformance</span>
<span class="c1">/// automatically, and you can add `Hashable` conformance to your other custom</span>
<span class="c1">/// types by implementing the `hash(into:)` function. For structs whose stored</span>
<span class="c1">/// properties are all `Hashable`, and for enum types that have all-`Hashable`</span>
<span class="c1">/// associated values, the compiler is able to provide an implementation of</span>
<span class="c1">/// `hash(into:)` automatically.</span>
<span class="c1">///</span>
<span class="c1">/// Hashing a value means feeding its essential components into a hash function,</span>
<span class="c1">/// represented by the `Hasher` type. Essential components are those that</span>
<span class="c1">/// contribute to the type's implementation of `Equatable`. Two instances that</span>
<span class="c1">/// are equal must feed the same values to `Hasher` in `hash(into:)`, in the</span>
<span class="c1">/// same order.</span>
<span class="c1">///</span>
<span class="c1">/// Conforming to the Hashable Protocol</span>
<span class="c1">/// ===================================</span>
<span class="c1">///</span>
<span class="c1">/// To use your own custom type in a set or as the key type of a dictionary,</span>
<span class="c1">/// add `Hashable` conformance to your type. The `Hashable` protocol inherits</span>
<span class="c1">/// from the `Equatable` protocol, so you must also satisfy that protocol's</span>
<span class="c1">/// requirements.</span>
<span class="c1">///</span>
<span class="c1">/// A custom type's `Hashable` and `Equatable` requirements are automatically</span>
<span class="c1">/// synthesized by the compiler when you declare `Hashable` conformance in the</span>
<span class="c1">/// type's original declaration and your type meets these criteria:</span>
<span class="c1">///</span>
<span class="c1">/// - For a `struct`, all its stored properties must conform to `Hashable`.</span>
<span class="c1">/// - For an `enum`, all its associated values must conform to `Hashable`. (An</span>
<span class="c1">///   `enum` without associated values has `Hashable` conformance even without</span>
<span class="c1">///   the declaration.)</span>
<span class="c1">///</span>
<span class="c1">/// To customize your type's `Hashable` conformance, to adopt `Hashable` in a</span>
<span class="c1">/// type that doesn't meet the criteria listed above, or to extend an existing</span>
<span class="c1">/// type to conform to `Hashable`, implement the `hash(into:)` function in your</span>
<span class="c1">/// custom type. To ensure that your type meets the semantic requirements of the</span>
<span class="c1">/// `Hashable` and `Equatable` protocols, it's a good idea to also customize</span>
<span class="c1">/// your type's `Equatable` conformance to match the `hash(into:)` definition.</span>
<span class="c1">///</span>
<span class="c1">/// As an example, consider a `GridPoint` type that describes a location in a</span>
<span class="c1">/// grid of buttons. Here's the initial declaration of the `GridPoint` type:</span>
<span class="c1">///</span>
<span class="c1">///     /// A point in an x-y coordinate system.</span>
<span class="c1">///     struct GridPoint {</span>
<span class="c1">///         var x: Int</span>
<span class="c1">///         var y: Int</span>
<span class="c1">///     }</span>
<span class="c1">///</span>
<span class="c1">/// You'd like to create a set of the grid points where a user has already</span>
<span class="c1">/// tapped. Because the `GridPoint` type is not hashable yet, it can't be used</span>
<span class="c1">/// as the `Element` type for a set. To add `Hashable` conformance, provide an</span>
<span class="c1">/// `==` operator function and a `hash(into:)` function.</span>
<span class="c1">///</span>
<span class="c1">///     extension GridPoint: Hashable {</span>
<span class="c1">///         func hash(into hasher: inout Hasher) {</span>
<span class="c1">///             hasher.combine(x)</span>
<span class="c1">///             hasher.combine(y)</span>
<span class="c1">///         }</span>
<span class="c1">///</span>
<span class="c1">///         static func == (lhs: GridPoint, rhs: GridPoint) -&gt; Bool {</span>
<span class="c1">///             return lhs.x == rhs.x &amp;&amp; lhs.y == rhs.y</span>
<span class="c1">///         }</span>
<span class="c1">///     }</span>
<span class="c1">///</span>
<span class="c1">/// The `hash(into:)` property in this example feeds the properties `x` and `y`</span>
<span class="c1">/// to the supplied hasher; these are the same properties compared by the</span>
<span class="c1">/// implementation of the `==` operator function.</span>
<span class="c1">///</span>
<span class="c1">/// Now that `GridPoint` conforms to the `Hashable` protocol, you can create a</span>
<span class="c1">/// set of previously tapped grid points.</span>
<span class="c1">///</span>
<span class="c1">///     var tappedPoints: Set = [GridPoint(x: 2, y: 3), GridPoint(x: 4, y: 1)]</span>
<span class="c1">///     let nextTap = GridPoint(x: 0, y: 1)</span>
<span class="c1">///     if tappedPoints.contains(nextTap) {</span>
<span class="c1">///         print("Already tapped at (\(nextTap.x), \(nextTap.y)).")</span>
<span class="c1">///     } else {</span>
<span class="c1">///         tappedPoints.insert(nextTap)</span>
<span class="c1">///         print("New tap detected at (\(nextTap.x), \(nextTap.y)).")</span>
<span class="c1">///     }</span>
<span class="c1">///     // Prints "New tap detected at (0, 1).")</span>
<span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">Hashable</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
  <span class="c1">/// The hash value.</span>
  <span class="c1">///</span>
  <span class="c1">/// Hash values are not guaranteed to be equal across different executions of</span>
  <span class="c1">/// your program. Do not save hash values to use during a future execution.</span>
  <span class="k">var</span> <span class="nv">hashValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
  
  <span class="c1">/// Hash the essential components of this value into the hash function</span>
  <span class="c1">/// represented by `hasher`, by feeding them into it using its `combine`</span>
  <span class="c1">/// methods.</span>
  <span class="c1">///</span>
  <span class="c1">/// Essential components are precisely those that are compared in the type's</span>
  <span class="c1">/// implementation of `Equatable`.</span>
  <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">Hasher</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="source-compatibility"> <a href="#source-compatibility" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="source-compatibility">Source compatibility</a> </h2> <p>The introduction of the new <code class="highlighter-rouge">Hasher</code> type is a purely additive change. However, adding the <code class="highlighter-rouge">hash(into:)</code> requirement is potentially source breaking. To ensure we keep compatibility with code written for previous versions of Swift, while also allowing new code to only implement <code class="highlighter-rouge">hash(into:)</code>, we extend <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md">SE-0185</a>’s automatic <code class="highlighter-rouge">Hashable</code> synthesis to automatically derive either of these requirements when the other has been manually implemented.</p> <p>Code written for Swift 4.1 or earlier will continue to compile (in the corresponding language mode) after this proposal is implemented. The compiler will synthesize the missing <code class="highlighter-rouge">hash(into:)</code> requirement automatically:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct GridPoint41: Hashable { // Written for Swift 4.1 or below
  let x: Int
  let y: Int
  
  var hashValue: Int {
    return x.hashValue ^ y.hashValue &amp;* 16777619
  }
  
  // Supplied automatically by the compiler:
  func hash(into hasher: inout Hasher) {
    hasher.combine(self.hashValue)
  }
}
</code></pre></div></div> <p>The compiler will emit a deprecation warning when it needs to do this in 4.2 mode. (However, note that code that merely uses <code class="highlighter-rouge">hashValue</code> will continue to compile without warnings.)</p> <p>Code written for Swift 4.2 or later should conform to <code class="highlighter-rouge">Hashable</code> by implementing <code class="highlighter-rouge">hash(into:)</code>. The compiler will then complete the conformance with a suitable <code class="highlighter-rouge">hashValue</code> definition:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct GridPoint42: Hashable { // Written for Swift 4.2
  let x: Int
  let y: Int
  
  func hash(into hasher: inout Hasher) {
    hasher.combine(x)
    hasher.combine(y)
  }
  
  // Supplied automatically by the compiler:
  var hashValue: Int {
    var hasher = Hasher()
    self.hash(into: &amp;hasher)
    return hasher.finalize()
  }
}
</code></pre></div></div> <p>When upgrading to Swift 4.2, <code class="highlighter-rouge">Hashable</code> types written for earlier versions of Swift should be migrated to implement <code class="highlighter-rouge">hash(into:)</code> instead of <code class="highlighter-rouge">hashValue</code>.</p> <p>For types that satisfy <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0185-synthesize-equatable-hashable.md">SE-0185</a>’s requirements for <code class="highlighter-rouge">Hashable</code> synthesis, this can be as easy as removing the explicit <code class="highlighter-rouge">hashValue</code> implementation. Note that Swift 4.2 implements conditional <code class="highlighter-rouge">Hashable</code> conformances for many standard library types that didn’t have it before; this enables automatic <code class="highlighter-rouge">Hashable</code> synthesis for types that use these as components.</p> <p>For types that still need to manually implement <code class="highlighter-rouge">Hashable</code>, the migrator can be updated to help with this process. For example, the <code class="highlighter-rouge">GridPoint41.hashValue</code> implementation above can be mechanically rewritten as follows:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct GridPoint41: Hashable { // Migrated from Swift 4.1
  let x: Int
  let y: Int

  // Migrated from hashValue:
  func hash(into hasher: inout Hasher) {
    hash.combine(x.hashValue ^ y.hashValue &amp;* 16777619)
  }
}
</code></pre></div></div> <p>This will not provide the same hash quality as combining both members one by one, but it may be useful as a starting point.</p> <h2 id="effect-on-abi-stability"> <a href="#effect-on-abi-stability" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="abi">Effect on ABI stability</a> </h2> <p><code class="highlighter-rouge">Hasher</code> and <code class="highlighter-rouge">hash(into:)</code> are additive changes that extend the ABI of the standard library. <code class="highlighter-rouge">Hasher</code> is a fully resilient struct, with opaque size/layout and mostly opaque members. (The only exception is the generic function <code class="highlighter-rouge">combine(_:)</code>, which is provided as a syntactic convenience.)</p> <p>While this proposal deprecates the <code class="highlighter-rouge">hashValue</code> requirement, it doesn’t remove it. Types implementing <code class="highlighter-rouge">Hashable</code> will continue to provide an implementation for it, although the implementation may be provided automatically by compiler synthesis.</p> <p>To implement nondeterminism, <code class="highlighter-rouge">Hasher</code> uses an internal seed value initialized by the runtime during process startup. The seed is usually produced by a random number generator, but this may be disabled by defining the <code class="highlighter-rouge">SWIFT_DETERMINISTIC_HASHING</code> environment variable with a value of <code class="highlighter-rouge">1</code> prior to starting a Swift process.</p> <h2 id="effect-on-api-resilience"> <a href="#effect-on-api-resilience" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="resilience">Effect on API resilience</a> </h2> <p>Replacing <code class="highlighter-rouge">hashValue</code> with <code class="highlighter-rouge">hash(into:)</code> moves the responsibility of choosing a suitable hash function out of <code class="highlighter-rouge">Hashable</code> implementations and into the standard library, behind a resiliency boundary.</p> <p><code class="highlighter-rouge">Hasher</code> is explicitly designed so that future versions of the standard library will be able to replace the hash function. <code class="highlighter-rouge">Hashable</code> implementations compiled for previous versions will automatically pick up the improved algorithm when linked with the new release. This includes changing the size or internal layout of the <code class="highlighter-rouge">Hasher</code> state itself.</p> <p>(We foresee several reasons why we may want to replace the hash function. For example, we may need to do so if a weakness is discovered in the current function, to restore the reliability of <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code>. We may also want to tweak the hash function to adapt it to the special requirements of certain environments (such as network services), or to generally improve hashing performance.)</p> <h2 id="alternatives-considered"> <a href="#alternatives-considered" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="alternatives">Alternatives considered</a> </h2> <h3 id="leaving-hashable-as-is"> <a href="#leaving-hashable-as-is" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="leave-hashable-alone">Leaving <code class="highlighter-rouge">Hashable</code> as is</a> </h3> <p>One option that we considered is to expose <code class="highlighter-rouge">Hasher</code>, but to leave the <code class="highlighter-rouge">Hashable</code> protocol as is. Individual <code class="highlighter-rouge">Hashable</code> types would be able to choose whether or not to use it or to roll their own hash functions.</p> <p>We felt this was an unsatisfying approach; the rationale behind this is explained in the section on <a href="#hash-into">The <code class="highlighter-rouge">hash(into:)</code> requirement</a>.</p> <h3 id="defining-a-new-protocol"> <a href="#defining-a-new-protocol" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="new-protocol">Defining a new protocol</a> </h3> <p>There have been several attempts to fix <code class="highlighter-rouge">Hashable</code> by creating a new protocol to replace it. For example, there’s a prototype implementation of a <a href="https://github.com/apple/swift/blob/swift-4.1-branch/validation-test/stdlib/HashingPrototype.swift"><code class="highlighter-rouge">NewHashable</code> protocol</a> in the Swift test suite. The authors of this proposal have done their share of this, too: Karoy has previously published an open-source <a href="https://github.com/attaswift/SipHash">hashing package providing an opt-in replacement for <code class="highlighter-rouge">Hashable</code></a>, while Vincent wrote <a href="https://blog.definiteloops.com/ha-r-sh-visitors-8c0c3686a46f">a detailed pitch for adding a <code class="highlighter-rouge">HashVisitable</code> protocol to the standard library</a> – these efforts were direct precursors to this proposal.</p> <p>In these approaches, the new protocol could either be a refinement of <code class="highlighter-rouge">Hashable</code>, or it could be unrelated to it. Here is what a refinement would look like:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Hashable</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">hashValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="kt">Hashable2</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">Hasher</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Hashable2</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">hashValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">hasher</span> <span class="o">=</span> <span class="kt">Hasher</span><span class="p">()</span>
    <span class="nf">hash</span><span class="p">(</span><span class="nv">into</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">hasher</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="nf">finalize</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>While this is a great approach for external hashing packages, we believe it to be unsuitable for the standard library. Adding a new protocol would add a significant new source of user confusion about hashing, and it would needlessly expand the standard library’s API surface area.</p> <p>The new protocol would need to have a new name, but <code class="highlighter-rouge">Hashable</code> already has the perfect name for a protocol representing hashable things – so we’d need to choose an imperfect name for the “better” protocol.</p> <p>While deprecating a protocol requirement is a significant change, we believe it to be less harmful overall than leaving <code class="highlighter-rouge">Hashable</code> unchanged, or trying to have two parallel protocols for the same thing.</p> <p>Additionally, adding a second protocol would lead to complications with <code class="highlighter-rouge">Hashable</code> synthesis. It’s also unclear how <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code> would be able to consistently use <code class="highlighter-rouge">Hasher</code> for their primary hashing API. (These problems are not unsolvable, but they may involve adding special one-off compiler support for the new protocol. For example, we may want to automatically derive <code class="highlighter-rouge">Hashable2</code> conformance for all types that implement <code class="highlighter-rouge">Hashable</code>.)</p> <h3 id="making-hashinto-generic-over-a-hasher-protocol"> <a href="#making-hashinto-generic-over-a-hasher-protocol" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="generic-hasher">Making <code class="highlighter-rouge">hash(into:)</code> generic over a <code class="highlighter-rouge">Hasher</code> protocol</a> </h3> <p>It would be nice to allow Swift programmers to define their own hash functions, and to plug them into any <code class="highlighter-rouge">Hashable</code> type:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Hasher</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">combine</span><span class="p">(</span><span class="nv">bytes</span><span class="p">:</span> <span class="kt">UnsafeRawBufferPointer</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">protocol</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="n">hash</span><span class="o">&lt;</span><span class="kt">H</span><span class="p">:</span> <span class="kt">Hasher</span><span class="o">&gt;</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">H</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>However, we believe this would add a degree of generality whose costs are unjustifiable relative to their potential gain. We expect the ability to create custom hashers would rarely be exercised. For example, we do not foresee a need for adding support for custom hashers in <code class="highlighter-rouge">Set</code> and <code class="highlighter-rouge">Dictionary</code>. On the other hand, there are distinct advantages to standardizing on a single, high-quality hash function:</p> <ul> <li>Adding a generic type parameter to <code class="highlighter-rouge">hash(into:)</code> would complicate the <code class="highlighter-rouge">Hashable</code> API.</li> <li>By supporting only a single <code class="highlighter-rouge">Hasher</code>, we can concentrate our efforts on making sure it runs fast. For example, we know that the standard hasher’s opaque mutating functions won’t ever perform any retain/release operations, or otherwise mutate any of the reference types we may encounter during hashing; describing this fact to the compiler enables optimizations that would not otherwise be possible.</li> <li>Generics in Swift aren’t zero-cost abstractions. We may be tempted to think that we could gain some performance by plugging in a less sophisticated hash function. This is not necessarily the case – support for custom hashers comes with significant overhead that can easily overshadow the (slight, if any) algorithmic disadvantage of the standard <code class="highlighter-rouge">Hasher</code>.</li> </ul> <p>Note that the proposed non-generic <code class="highlighter-rouge">Hasher</code> still has full support for Bloom filters and other data structures that require multiple hash functions. (To select a different hash function, we just need to supply a new seed value.)</p> <h3 id="change-hashinto-to-take-a-closure-instead-of-a-new-type"> <a href="#change-hashinto-to-take-a-closure-instead-of-a-new-type" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <a name="closure-hasher">Change <code class="highlighter-rouge">hash(into:)</code> to take a closure instead of a new type</a> </h3> <p>A variant of the previous idea is to represent the hasher by a simple closure taking an integer argument:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="p">(</span><span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">GridPoint</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="p">(</span><span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">hasher</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nf">hasher</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>While this is an attractively minimal API, it has problems with granularity – it doesn’t allow adding anything less than an <code class="highlighter-rouge">Int</code>’s worth of bits to the hash state.</p> <p>Additionally, like generics, the performance of such a closure-based interface would compare unfavorably to <code class="highlighter-rouge">Hasher</code>, since the compiler wouldn’t be able to guarantee anything about the potential side-effects of the closure.</p> </div> </div> </div> </div> </body> </html>
